{
 "espireDate": "N",
 "format": "text",
 "jSonReasons": [
  "re_sql",
  "lg_en",
  "re_ast1"
 ],
 "key": "AMLDZcZn",
 "pasteDate": "Feb 12, 2018, 9:34:26 AM",
 "relevancy": -1.0,
 "relevant": false,
 "text": "//====================== UFF Race System-========\n//============ By Oblivion (2018)=================\n\n//Includes\n#include <a_samp>\n#include <YSI\\y_iterate>\n#include <YSI\\y_timers>\n#include <zcmd>\n#include <streamer>\n\n// ----- Base de Datos -----\n#define sql_database         \"CarrerasLol.db\"\n// ----- Definicin de CallBacks ----\n#define CallBack:%0(%1) forward%0(%1); public%0(%1)\n// ---- Definicin de Loops y macros\n#define Loop(%0,%1) \\\n\tfor(new %0 = 0; %0 != %1; %0++)\n\n#define IsOdd(%1) \\\n\t((%1) & 1)\n\n#define ConvertTime(%0,%1,%2,%3,%4) \\\n\tnew \\\n\t    Float: %0 = floatdiv(%1, 60000) \\\n\t;\\\n\t%2 = floatround(%0, floatround_tozero); \\\n\t%3 = floatround(floatmul(%0 - %2, 60), floatround_tozero); \\\n\t%4 = floatround(floatmul(floatmul(%0 - %2, 60) - %3, 1000), floatround_tozero)\n// ---- Definicin ajutes de carreras ----\n#define MAX_CP_POR_CARRERA\t120\n#define CONTEO_INICIA_CARRERA\t35 //Segundos\n#define MAX_TIEMPO_CARRERA\t300 //Segundos\n#define CARRERA_CP_TAMAO\t14.0\n// ---- Dilogos ----\n#define DIALOGO_SIN_USO         0\n#define DIALOGO_SERVER_DATOS    1\n#define DIALOGO_MAS_CARRERAS    2\n// ---- Colores ----\n#define COL_BLANCO           \"{FFFFFF}\"\n#define COL_VERDE            \"{00FF00}\"\n#define COL_AMARILLO         \"{FFFF00}\"\n#define COL_ROJO             \"{FF0000}\"\n\n#define COLOR_ROJO           0xFF0000AA\n#define COLOR_AMARILLO       0xFFFF00AA\n#define COLOR_AZUL           0x33CCFFAA\n// ---- Variables ----\nenum pInfo\n{\n//    ScoreCarrera,\n    Consulta,\n\tpID,\n\tbool:EsCorredor,\n\tCPProgess,\n\tPosicionCarrera,\n\tTimer:InfoTimer,\n\tVehiculo\n};\nnew Usuario[MAX_PLAYERS][pInfo];\n\nnew BuildRace,\n\tBuildRaceType,\n\tBuildModeVID = -1,\n\tBuildName[30],\n\tbool: BuildTakeVehPos,\n\tBuildVehPosCount,\n\tbool: BuildTakeCheckpoints,\n\tBuildCheckPointCount,\n\tRaceBusy = 0x00,\n\tRaceName[30],\n\tRaceVehicle,\n\tRaceType,\n\tTotalCP,\n\tFloat: RaceVehCoords[2][4],\n\tFloat: CPCoords[MAX_CP_POR_CARRERA][4],\n\tIndex,\n\tPlayersCount[2],\n\tTimer:CountTimer,\n\tCountAmountRace,\n\tRaceTick,\n\tRaceStarted,\n\tPosition,\n\tFinishCount,\n\tJoinCount,\n\tTimer:rCounter,\n\tRaceTime,\n \tTotalRaces,\n \tTimeProgress\n;\nnew stock g_arrVehicleNames[][] =\n{\n    \"Landstalker\", \"Bravura\", \"Buffalo\", \"Linerunner\", \"Perrenial\", \"Sentinel\", \"Dumper\", \"Firetruck\", \"Trashmaster\",\n    \"Stretch\", \"Manana\", \"Infernus\", \"Voodoo\", \"Pony\", \"Mule\", \"Cheetah\", \"Ambulance\", \"Leviathan\", \"Moonbeam\",\n    \"Esperanto\", \"Taxi\", \"Washington\", \"Bobcat\", \"Whoopee\", \"BF Injection\", \"Hunter\", \"Premier\", \"Enforcer\",\n    \"Securicar\", \"Banshee\", \"Predator\", \"Bus\", \"Rhino\", \"Barracks\", \"Hotknife\", \"Trailer\", \"Previon\", \"Coach\",\n    \"Cabbie\", \"Stallion\", \"Rumpo\", \"RC Bandit\", \"Romero\", \"Packer\", \"Monster\", \"Admiral\", \"Squalo\", \"Seasparrow\",\n    \"Pizzaboy\", \"Tram\", \"Trailer\", \"Turismo\", \"Speeder\", \"Reefer\", \"Tropic\", \"Flatbed\", \"Yankee\", \"Caddy\", \"Solair\",\n    \"Berkley's RC Van\", \"Skimmer\", \"PCJ-600\", \"Faggio\", \"Freeway\", \"RC Baron\", \"RC Raider\", \"Glendale\", \"Oceanic\",\n    \"Sanchez\", \"Sparrow\", \"Patriot\", \"Quad\", \"Coastguard\", \"Dinghy\", \"Hermes\", \"Sabre\", \"Rustler\", \"ZR-350\", \"Walton\",\n    \"Regina\", \"Comet\", \"BMX\", \"Burrito\", \"Camper\", \"Marquis\", \"Baggage\", \"Dozer\", \"Maverick\", \"News Chopper\", \"Rancher\",\n    \"FBI Rancher\", \"Virgo\", \"Greenwood\", \"Jetmax\", \"Hotring\", \"Sandking\", \"Blista Compact\", \"Police Maverick\",\n    \"Boxville\", \"Benson\", \"Mesa\", \"RC Goblin\", \"Hotring Racer A\", \"Hotring Racer B\", \"Bloodring Banger\", \"Rancher\",\n    \"Super GT\", \"Elegant\", \"Journey\", \"Bike\", \"Mountain Bike\", \"Beagle\", \"Cropduster\", \"Stunt Plane\", \"Tanker\", \"Roadtrain\",\n    \"Nebula\", \"Majestic\", \"Buccaneer\", \"Shamal\", \"Hydra\", \"FCR-900\", \"NRG-500\", \"HPV1000\", \"Cement Truck\", \"Tow Truck\",\n    \"Fortune\", \"Cadrona\", \"SWAT Truck\", \"Willard\", \"Forklift\", \"Tractor\", \"Combine\", \"Feltzer\", \"Remington\", \"Slamvan\",\n    \"Blade\", \"Streak\", \"Freight\", \"Vortex\", \"Vincent\", \"Bullet\", \"Clover\", \"Sadler\", \"Firetruck\", \"Hustler\", \"Intruder\",\n    \"Primo\", \"Cargobob\", \"Tampa\", \"Sunrise\", \"Merit\", \"Utility\", \"Nevada\", \"Yosemite\", \"Windsor\", \"Monster\", \"Monster\",\n    \"Uranus\", \"Jester\", \"Sultan\", \"Stratum\", \"Elegy\", \"Raindance\", \"RC Tiger\", \"Flash\", \"Tahoma\", \"Savanna\", \"Bandito\",\n    \"Freight Flat\", \"Streak Carriage\", \"Kart\", \"Mower\", \"Dune\", \"Sweeper\", \"Broadway\", \"Tornado\", \"AT-400\", \"DFT-30\",\n    \"Huntley\", \"Stafford\", \"BF-400\", \"News Van\", \"Tug\", \"Trailer\", \"Emperor\", \"Wayfarer\", \"Euros\", \"Hotdog\", \"Club\",\n    \"Freight Box\", \"Trailer\", \"Andromada\", \"Dodo\", \"RC Cam\", \"Launch\", \"LSPD Car\", \"SFPD Car\", \"LVPD Car\",\n    \"Police Rancher\", \"Picador\", \"S.W.A.T\", \"Alpha\", \"Phoenix\", \"Glendale\", \"Sadler\", \"Luggage\", \"Luggage\", \"Stairs\",\n    \"Boxville\", \"Tiller\", \"Utility Trailer\", \"Jetpack\"\n};\n\nnew bool:SRaces;\nstatic DB:ZLDB;\n// ---- TextDraws ----\nnew Text:AnuncioEvento          = Text:INVALID_TEXT_DRAW;\nnew Text:EmpezarCarrera     \t\t= Text:INVALID_TEXT_DRAW;\n\nnew PlayerText:RaceInfoText\t    = PlayerText:INVALID_TEXT_DRAW;\n\n// ---- CallBacks ----\npublic OnFilterScriptInit()\n{\n    TextosDePantalla();\n\tSRaces = true;\n\n\tZLDB = db_open(sql_database);\n    new DB:bd = db_open(sql_database);\n\n\tif (bd)\n\t{\n\t\tdb_free_result(db_query(bd\n\t\t\t, \"CREATE TABLE IF NOT EXISTS CARRERA (ID_CARRERA INTEGER NOT \\\n\t\t\tNULL PRIMARY KEY, NOMBRE TEXT NOT NULL, MODELO_VEHICULO INTEGER \\\n\t\t\tNOT NULL, TIPO_CARRERA INTEGER NOT NULL)\"));\n\n\t\tdb_free_result(db_query(bd\n\t\t\t, \"CREATE TABLE IF NOT EXISTS TIEMPO_CARRERA (ID_CARRERA INTEGER \\\n\t\t\tNOT NULL REFERENCES CARRERA(ID_CARRERA), NUMERO_POSICION INTEGER \\\n\t\t\tNOT NULL, TIEMPO INTEGER NOT NULL, NOMBRE_CORREDOR INTEGER NOT NULL, \\\n\t\t\tPRIMARY KEY (ID_CARRERA, NUMERO_POSICION))\"));\n\n\t\tdb_free_result(db_query(bd\n\t\t\t, \"CREATE TABLE IF NOT EXISTS POSICION_PARTIDA_CARRERA (ID_CARRERA \\\n\t\t\tINTEGER NOT NULL REFERENCES CARRERA(ID_CARRERA), NUMERO_POSICION \\\n\t\t\tINTEGER NOT NULL, COORDENADA_X REAL NOT NULL, COORDENADA_Y REAL \\\n\t\t\tNOT NULL, COORDENADA_Z REAL NOT NULL, ROTACION REAL NOT NULL, \\\n\t\t\tPRIMARY KEY (ID_CARRERA, NUMERO_POSICION))\"));\n\n\t\tdb_free_result(db_query(bd\n\t\t\t, \"CREATE TABLE IF NOT EXISTS PUNTO_CONTROL_CARRERA (ID_CARRERA \\\n\t\t\tINTEGER NOT NULL REFERENCES CARRERA(ID_CARRERA), ID_PUNTO_CONTROL INTEGER \\\n\t\t\tNOT NULL, COORDENADA_X REAL NOT NULL, COORDENADA_Y REAL NOT NULL, \\\n\t\t\tCOORDENADA_Z REAL NOT NULL, PRIMARY KEY (ID_CARRERA, \\\n\t\t\tID_PUNTO_CONTROL))\"));\n\n\t\tdb_close(bd);\n\t}\n    return 1;\n}\n\npublic OnFilterScriptExit()\n{\n\tTextDrawHideForAll(AnuncioEvento);\n\tforeach(new i : Player)\n\t{\n\t\tDisablePlayerRaceCheckpoint(i);\n\t\tUsuario[i][EsCorredor] = false;\n\t\tDisableRemoteVehicleCollisions(i,0);\n\t\tstop Usuario[i][InfoTimer];\n\t}\n\tJoinCount = 0;\n\tFinishCount = 0;\n\tTimeProgress = 0;\n\tdb_close(ZLDB);\n    return 1;\n}\n\npublic OnPlayerConnect(playerid)\n{\n    TextosDePantallaPlayer(playerid);\n\treturn 1;\n}\n\npublic OnPlayerDisconnect(playerid, reason)\n{\n\tnew Razon[3][] = {\"Crash\",\"Salio\",\"Expulsado\"};\n\n\tPlayerTextDrawDestroy(playerid, RaceInfoText);\n    if(Usuario[playerid][EsCorredor] == true)\n    {\n\t\tJoinCount--;\n\t\tUsuario[playerid][EsCorredor] = false;\n\t\tSetVehicleHealth(GetPlayerVehicleID(playerid),1250.0);\n\t\tDisableRemoteVehicleCollisions(playerid,0);\n\t\tDisablePlayerRaceCheckpoint(playerid);\n        PlayerTextDrawHide(playerid, RaceInfoText);\n\t\tUsuario[playerid][CPProgess] = 0;\n\t\tstop Usuario[playerid][InfoTimer];\n\t\tSendClientMessageToAllEx(COLOR_AMARILLO, \" Info  \"COL_BLANCO\"El jugador %s ha salido de la carrera (razn: %s)\",pName(playerid),Razon[reason]);\n\t}\n\tif(BuildRace == playerid+1)\n\t{\n\t    BuildRace = 0;\n\t\tBuildCheckPointCount = 0;\n\t\tBuildVehPosCount = 0;\n\t\tBuildTakeCheckpoints = false;\n\t\tBuildTakeVehPos = false;\n\t\tBorrarCarrera(BuildName);\n\t}\n    return 1;\n}\n\npublic OnPlayerDeath(playerid, killerid, reason)\n{\n\tif(BuildRace == playerid+1)\n\t{\n\t\tBuildRace = 0;\n\t\tBuildCheckPointCount = 0;\n\t\tBuildVehPosCount = 0;\n\t\tBuildTakeCheckpoints = false;\n\t\tBuildTakeVehPos = false;\n\t\tBorrarCarrera(BuildName);\n\t}\n    return 1;\n}\n\npublic OnPlayerSpawn(playerid)\n{\n    if(Usuario[playerid][EsCorredor] == true)\n    {\n\t\tif(IsPlayerInAnyVehicle(playerid) && GetPlayerState(playerid) == PLAYER_STATE_DRIVER)\n\t\t{\n\t\t\tSetVehiclePos(GetPlayerVehicleID(playerid),CPCoords[Usuario[playerid][CPProgess]-1][0],CPCoords[Usuario[playerid][CPProgess]-1][1],CPCoords[Usuario[playerid][CPProgess]-1][2]);\n\t\t\tSetCameraBehindPlayer(playerid);\n\t \t}\n\t\telse\n\t\t{\n\t\t\tSetPlayerPos(playerid,CPCoords[Usuario[playerid][CPProgess]-1][0],CPCoords[Usuario[playerid][CPProgess]-1][1],CPCoords[Usuario[playerid][CPProgess]-1][2]);\n\t\t\tSetCameraBehindPlayer(playerid);\n\t\t\tdefer DarAuto[1000](playerid);\n\t  \t}\n\t\tSendClientMessage(playerid,COLOR_AZUL,\" \"COL_BLANCO\"Has sido teletransportado automticamente al ltimo punto de control que tocaste.\");\n\t\tSendClientMessage(playerid,COLOR_AZUL,\" \"COL_BLANCO\"Si quieres salir de la carrera, tipea {33CCFF}/salir\");\n\t}\n\treturn 1;\n}\n\npublic OnPlayerCommandReceived(playerid, cmdtext[])\n{\n\tif(Usuario[playerid][EsCorredor] == true && strfind(cmdtext,\"salir\",true) == -1 && strfind(cmdtext,\"citem\",true) == -1)\n\t{\n\t\tSendClientMessage(playerid,COLOR_ROJO, \" Error  \"COL_BLANCO\"No puedes usar comandos estando en la carrera, usa /salir para salir.\");\n\t\treturn 0;\n\t}\n    return 1;\n}\n\npublic OnPlayerEnterRaceCheckpoint(playerid)\n{\n\tif(Usuario[playerid][CPProgess] == TotalCP -1)\n\t{\n\t\tnew TimeStamp,TotalRaceTime,rTime[3],Prize[2],tiempo[35];\n\t\tPosition++;\n\t\tTimeStamp = GetTickCount();\n\t\tTotalRaceTime = TimeStamp - RaceTick;\n\t\tConvertTime(var, TotalRaceTime, rTime[0], rTime[1], rTime[2]);\n\t\tif(rTime[0] >= 2 && rTime[1] >= 1){format(tiempo, 30, \"%d minutos con %d segundos\",rTime[0], rTime[1]);}\n\t\telse if(rTime[0] == 1 && rTime[1] >= 1){format((tiempo), 27, \"1 minuto con %d segundos\", rTime[1]);}\n\t\telse if(rTime[0] < 1 && rTime[1] >= 1){format((tiempo), 12, \"%d segundos\",rTime[1]);}\n\n\t\tswitch(Position)\n\t\t{\n\t\t    case 1: Prize[0] = 150, Prize[1] = 10000;\n\t\t    case 2: Prize[0] = 100, Prize[1] = 9000;\n\t\t    case 3: Prize[0] = 80, Prize[1] = 8000;\n\t\t    case 4: Prize[0] = 50, Prize[1] = 7000;\n\t\t    case 5: Prize[0] = 50, Prize[1] = 6000;\n\t\t    case 6: Prize[0] = 30, Prize[1] = 5000;\n\t\t    case 7: Prize[0] = 30, Prize[1] = 4000;\n\t\t    case 8: Prize[0] = 30, Prize[1] = 3000;\n\t\t    case 9: Prize[0] = 20, Prize[1] = 2000;\n\t\t    default: Prize[0] = 10, Prize[1] = 1000;\n\t\t}\n\t\tif(Position == 1)\n\t\t{\n\t\t\tSendClientMessageToAllEx(COLOR_AZUL, \" carrera  %s(ID:%d) ha ganado la carrera '%s' en %s (Premio: +%d Score y +$%d)\", pName(playerid), playerid, RaceName, tiempo, Prize[0], Prize[1]);\n\t\t\tSendClientMessageToAll(-1, \"\"COL_VERDE\" \"COL_BLANCO\"Bono 1er lugar: \"COL_VERDE\"5 Rockets\");\n\t\t\tGivePlayerMoney(playerid, Prize[1]);\n\t\t\tnew score = GetPlayerScore(playerid); SetPlayerScore(playerid, score+Prize[0]);\n\t\t\tGivePlayerWeapon(playerid, WEAPON_ROCKETLAUNCHER, 5);\n//\t    \tUsuario[playerid][ScoreCarrera] = Usuario[playerid][ScoreCarrera]+ 1;\n\t    \tGuardarScoreRace(playerid);\n\t    \tGuardarScoreFreeRoam(playerid);\n\t\t}\n\t\telse if(Position >= 2)\n\t\t{\n\t\t\tSendClientMessageToAllEx(COLOR_AZUL, \" carrera  %s(ID:%d) ha finalizado la carrera '%s' [Posicin #%d - Tiempo: %s]\", pName(playerid), playerid, RaceName, Position, tiempo);\n\t\t\tSendClientMessageToAllEx(-1, \"\"COL_VERDE\" \"COL_BLANCO\"Premio #%d lugar: \"COL_VERDE\"+%d Score y +$%d\",Position, Prize[0], Prize[1]);\n\n\t\t\tGivePlayerMoney(playerid, Prize[1]);\n\t\t\tnew score = GetPlayerScore(playerid); SetPlayerScore(playerid, score+Prize[0]);\n\t\t}\n\t\tif(FinishCount <= 5)\n\t\t{\n\t\t\tif (EsTiempoRecord(RaceName, TimeProgress+1, TotalRaceTime))\n\t\t\t{\n\t\t\t\tif (!HayTiemposRegistrados(RaceName, TimeProgress+1))\n\t\t\t\t{\n\t\t\t\t    if(TimeProgress+1 <= 3)\n\t\t\t\t\t{\n\t\t\t\t\t\tSendClientMessageToAllEx(COLOR_AZUL, \" record  %s ha hecho un nuevo record en la carrera '%s' y recibe un bono de $1000.000\", pName(playerid), RaceName);\n    \t\t            AlmacenarTiempoCarrera(RaceName, TimeProgress+1, TotalRaceTime, Usuario[playerid][pID]);\n    \t\t            GivePlayerMoney(playerid, 1000000);\n    \t            }\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tnew nombreCorredorRecordPrevio, tiempoRecordPrevio;\n\t\t\t\t\tObtenerRecordPrevio(RaceName, TimeProgress+1, TotalRaceTime, nombreCorredorRecordPrevio, tiempoRecordPrevio);\n\t\t\t\t\tnew Dueno[24];\n\t\t\t\t\tDueno = \"Testing Dialog\";\n/*\n\t\t\t\t\tnew Query[120], Dueno[MAX_PLAYER_NAME], DBResult:Result;\n   \t\t\t\t\tformat(Query, sizeof(Query), \"SELECT `NICK` FROM `USERS` WHERE `ID` = '%d' COLLATE NOCASE\", nombreCorredorRecordPrevio);\n   \t\t\t\t\tResult = db_query(ZLDB, Query);\n   \t\t\t\t\tif(db_num_rows(Result)) db_get_field_assoc(Result, \"NICK\",Dueno, 25);\n\t\t\t\t\tdb_free_result(Result);\n*/\n\t\t\t\t\tif(Usuario[playerid][pID] == nombreCorredorRecordPrevio)\n\t\t\t\t\t{\n\t\t\t\t\t\tSendClientMessageToAllEx(COLOR_AZUL, \" record  %s ha superado su propio record en la carrera '%s' y recibe un bono de $500000\", pName(playerid), RaceName);\n\t\t\t\t\t\tGivePlayerMoney(playerid, 500000);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tSendClientMessageToAllEx(COLOR_AZUL, \" record  %s ha superado el record de %s en la carrera '%s' y recibe un bono de $250000\", pName(playerid), Dueno, RaceName);\n\t\t\t\t\t\tGivePlayerMoney(playerid, 250000);\n\t\t\t\t\t}\n\t\t\t\t\tActualizarTiempoCarrera(RaceName, TimeProgress+1, TotalRaceTime, Usuario[playerid][pID]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tTimeProgress++;\n\t\t}\n\t\tFinishCount++;\n    \tDisablePlayerRaceCheckpoint(playerid);\n\t\tUsuario[playerid][CPProgess]++;\n\t\tUsuario[playerid][EsCorredor] = false;\n\t\tSetVehicleHealth(GetPlayerVehicleID(playerid),1250.0);\n\t\tDisableRemoteVehicleCollisions(playerid,0);\n\t\tPlayerTextDrawHide(playerid, RaceInfoText);\n\t    stop Usuario[playerid][InfoTimer];\n\t    SetCameraBehindPlayer(playerid);\n        SetPlayerVirtualWorld(playerid, 0);\n\t\tif(FinishCount >= JoinCount) return DetenerCarrera();\n    }\n\telse\n\t{\n\t\tUsuario[playerid][CPProgess]++;\n\t\tCPCoords[Usuario[playerid][CPProgess]][3]++;\n\t\tUsuario[playerid][PosicionCarrera] = floatround(CPCoords[Usuario[playerid][CPProgess]][3], floatround_floor);\n\t    SetCP(playerid, Usuario[playerid][CPProgess], Usuario[playerid][CPProgess]+1, TotalCP, RaceType);\n\t    PlayerPlaySound(playerid, 1137, 0.0, 0.0, 0.0);\n\t}\n    return 1;\n}\n\npublic OnPlayerKeyStateChange(playerid, newkeys, oldkeys)\n{\n\tif(Usuario[playerid][EsCorredor] == true)\n \t{\n\t\tif(newkeys & KEY_CROUCH)\n \t\t{\n\t\t\tif(IsPlayerInAnyVehicle(playerid) && GetPlayerState(playerid) == PLAYER_STATE_DRIVER)\n\t\t\t{\n\t\t    \tSetVehiclePos(GetPlayerVehicleID(playerid),CPCoords[Usuario[playerid][CPProgess]-1][0],CPCoords[Usuario[playerid][CPProgess]-1][1],CPCoords[Usuario[playerid][CPProgess]-1][2]);\n\t\t        SetCameraBehindPlayer(playerid);\n\t    \t}\n\t\t\telse\n\t\t\t{\n\t\t\t    SetPlayerPos(playerid,CPCoords[Usuario[playerid][CPProgess]-1][0],CPCoords[Usuario[playerid][CPProgess]-1][1],CPCoords[Usuario[playerid][CPProgess]-1][2]);\n\t\t\t    SetCameraBehindPlayer(playerid);\n\t\t\t    defer DarAuto[1000](playerid);\n\t      \t}\n\t      \tSendClientMessage(playerid,COLOR_AZUL,\" \"COL_BLANCO\"Has sido teletransportado automticamente al ltimo punto de control que tocaste.\");\n\t\t}\n\t}\n\tif(newkeys & KEY_FIRE)\n\t{\n\t    if(BuildRace == playerid+1)\n\t    {\n\t        new Float: vPos[4];\n\t\t\tif(BuildTakeVehPos == true)\n\t\t\t{\n\t\t\t\tif(!IsPlayerInAnyVehicle(playerid)) return SendClientMessage(playerid, COLOR_ROJO, \" Error  \"COL_BLANCO\"Necesitas estar en un vehculo.\");\n\t\t\t\tGetVehiclePos(GetPlayerVehicleID(playerid), vPos[0], vPos[1], vPos[2]);\n\t\t\t\tGetVehicleZAngle(GetPlayerVehicleID(playerid), vPos[3]);\n\t\t\t\tAgregarPosicionPartida(BuildName, BuildVehPosCount, vPos[0], vPos[1], vPos[2], vPos[3]);\n\t\t\t\tSendClientMessageEx(playerid, COLOR_AMARILLO, \" Info  \"COL_BLANCO\"La posicin del vehculo #%d ha sido colocada.\", BuildVehPosCount+1);\n\t\t        BuildVehPosCount++;\n\t\t\t}\n   \t\t\tif(BuildVehPosCount >= 2)\n\t\t    {\n\t\t        BuildVehPosCount = 0;\n\t\t        BuildTakeVehPos = false;\n\t\t        MostrarDialogo(playerid, 605);\n\t\t    }\n\t\t\tif(BuildTakeCheckpoints == true)\n\t\t\t{\n\t\t\t    if(BuildCheckPointCount > MAX_CP_POR_CARRERA) return SendClientMessage(playerid, COLOR_ROJO, \" Error  \"COL_BLANCO\"Has alcanzado la cantidad mxima de checkpoints.\");\n\t\t\t    if(!IsPlayerInAnyVehicle(playerid)) return SendClientMessage(playerid, COLOR_ROJO, \" Error  \"COL_BLANCO\"Necesitas estar en un vehculo.\");\n\t\t\t\tGetVehiclePos(GetPlayerVehicleID(playerid), vPos[0], vPos[1], vPos[2]);\n\t\t\t\tAgregarPuntoControl(BuildName, BuildCheckPointCount, vPos[0], vPos[1], vPos[2]);\n\t\t\t\tSendClientMessageEx(playerid, COLOR_AMARILLO, \" Info  \"COL_BLANCO\"El checkpoint #%d ha sido colocado.\", BuildCheckPointCount+1);\n\t\t\t\tBuildCheckPointCount++;\n\t\t\t}\n\t\t}\n\t}\n\tif(newkeys & KEY_SECONDARY_ATTACK)\n\t{\n\t    if(BuildRace == playerid+1)\n\t    {\n\t\t    if(BuildTakeCheckpoints == true)\n\t\t    {\n\t\t\t\tMostrarDialogo(playerid, 606);\n\t\t\t\tTotalRaces = ContarCarrerasAlmacenadas();\n\t\t\t\tTotalRaces++;\n\t\t    }\n\t    }\n\t}\n\treturn 1;\n}\n\npublic OnDialogResponse(playerid, dialogid, response, listitem, inputtext[])\n{\n    switch(dialogid)\n    {\n\t    case DIALOGO_SERVER_DATOS:\n\t\t{\n\t\t\tif(response)\n\t\t\t{\n\t\t\t    switch(listitem)\n\t\t\t\t{\n\t\t\t\t\tcase 0:\n\t\t\t\t\t{\n\t\t\t\t\t    if(SRaces == false)\n\t\t\t\t\t    {\n\t\t\t\t\t\t    SRaces = true;\n\t\t\t\t\t\t    SendClientMessageToAllEx(COLOR_AMARILLO, \" Info  \"COL_BLANCO\"El administrador %s(ID:%d) ha activado las carreras.\", pName(playerid),playerid);\n\t\t\t\t\t\t    CallRemoteFunction(\"OnPlayerCommandText\", \"is\", playerid, \"/cpanel\");\n\t\t\t\t\t    }\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t    \tSRaces = false;\n\t\t\t\t\t\t    SendClientMessageToAllEx(COLOR_AMARILLO, \" Info  \"COL_BLANCO\"El administrador %s(ID:%d) ha desactivado las carreras.\", pName(playerid),playerid);\n\t\t\t\t\t\t    CallRemoteFunction(\"OnPlayerCommandText\", \"is\", playerid, \"/cpanel\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tforeach(new i : Player) PlayerPlaySound(i,1057,0.0,0.0,0.0);\n\t\t\t\t    }\n\t\t\t\t    case 1: cmd_detenercarrera(playerid);\n\t\t\t\t    case 2: cmd_iniciarcarrera(playerid);\n\t\t\t\t    case 3: cmd_crearcarrera(playerid);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t    case DIALOGO_MAS_CARRERAS:\n\t    {\n\t\t    if(!response)\n\t\t    {\n\t\t\t    Usuario[playerid][Consulta] = Usuario[playerid][Consulta]+20;\n\t\t\t    CallRemoteFunction(\"OnPlayerCommandText\", \"is\", playerid, \"/iniciarcarrera\");\n\t\t    }\n\t\t    if(response)\n\t\t    {\n\t\t\t    Usuario[playerid][Consulta] = 0;\n\t\t\t    if(SRaces == false) return SendClientMessage(playerid, COLOR_ROJO, \" Error  \"COL_BLANCO\"Las carreras fueron desactivadas por un administrador.\");\n\t\t\t    if(BuildRace != 0) return SendClientMessage(playerid, COLOR_ROJO, \" Error  \"COL_BLANCO\"Alguien est construyendo una carrera.\");\n\t\t\t    if(RaceBusy == 0x01 || RaceStarted > 0) return SendClientMessage(playerid, COLOR_ROJO, \" Error  \"COL_BLANCO\"Hay una carrera en curso, espera a que termine.\");\n\t\t\t    if(GetPlayerVirtualWorld(playerid) != 0) return SendClientMessage(playerid,COLOR_ROJO,\" Error  \"COL_BLANCO\"Debes estar en el mundo virtual 0.\");\n\t\t\t    LoadRace(playerid, listitem+1);\n\t\t    }\n\t    }\n\t\tcase 599:\n\t    {\n\t        if(!response) return BuildRace = 0;\n\t        switch(listitem)\n\t        {\n\t        \tcase 0: BuildRaceType = 0;\n\t        \tcase 1: BuildRaceType = 3;\n\t\t\t}\n\t\t\tMostrarDialogo(playerid, 600);\n\t    }\n\t    case 600..601:\n\t    {\n\t        if(!response) return MostrarDialogo(playerid, 599);\n\t        if(!strlen(inputtext)) return MostrarDialogo(playerid, 601);\n\t        if(strlen(inputtext) < 5 || strlen(inputtext) > 19) return MostrarDialogo(playerid, 601);\n\n\t\t\tnew string[138], DBResult:qresult;\n\t\t\tformat(string, sizeof(string), \"SELECT `NOMBRE` FROM `CARRERA` WHERE `NOMBRE` = '%s'\",inputtext);\n\t\t\tqresult = db_query(ZLDB, string);\n\n\t\t\tif(db_num_rows(qresult))\n\t\t\t{\n\t\t\t    db_free_result(qresult);\n\t\t\t\tSendClientMessage(playerid,COLOR_ROJO,\" Error  \"COL_BLANCO\"Esta carrera ya existe.\");\n                return MostrarDialogo(playerid, 600);\n\t\t\t}\n\n\t        strmid(BuildName, inputtext, 0, strlen(inputtext), sizeof(BuildName));\n\t        MostrarDialogo(playerid, 602);\n\t    }\n\t    case 602..603:\n\t    {\n\t        if(!response) return MostrarDialogo(playerid, 600);\n\t        if(!strlen(inputtext)) return MostrarDialogo(playerid, 603);\n\t        if(EsNumerico(inputtext))\n\t        {\n\t            if(!IsValidVehicle(strval(inputtext))) return MostrarDialogo(playerid, 603);\n\t\t\t\tnew Float: pPos[4];\n\t\t\t\tGetPlayerPos(playerid, pPos[0], pPos[1], pPos[2]);\n\t\t\t\tGetPlayerFacingAngle(playerid, pPos[3]);\n\t\t\t\tBuildModeVID = strval(inputtext);\n\t\t\t\tCrearVehiculo(playerid,strval(inputtext));\n\t\t\t\tMostrarDialogo(playerid, 604);\n\t\t\t}\n\t        else\n\t        {\n\t            if(!IsValidVehicle(ReturnVehicleID(inputtext))) return MostrarDialogo(playerid, 603);\n\t\t\t\tnew Float: pPos[4];\n\t\t\t\tGetPlayerPos(playerid, pPos[0], pPos[1], pPos[2]);\n\t\t\t\tGetPlayerFacingAngle(playerid, pPos[3]);\n\t\t\t\tBuildModeVID = ReturnVehicleID(inputtext);\n\t\t\t\tCrearVehiculo(playerid,ReturnVehicleID(inputtext));\n\t\t\t    MostrarDialogo(playerid, 604);\n\t\t\t}\n        }\n\t    case 604:\n\t    {\n\t        if(!response) return MostrarDialogo(playerid, 602);\n\t        AgregarCarrera(BuildName, BuildModeVID, BuildRaceType);\n\t\t\tSendClientMessage(playerid, COLOR_AMARILLO, \" Info  \"COL_BLANCO\"Ve a la lnea de inicio y presiona ~k~~VEHICLE_FIREWEAPON~ para poner la posicin #1, has lo mismo con la posicin #2\");\n\t\t\tSendClientMessage(playerid, COLOR_AMARILLO, \" Info  \"COL_BLANCO\"Luego de esto vers un dilogo para continuar.\");\n\t\t\tBuildVehPosCount = 0;\n\t        BuildTakeVehPos = true;\n\t    }\n\t    case 605:\n\t    {\n\t        if(!response) return MostrarDialogo(playerid, 604);\n\t        SendClientMessage(playerid, COLOR_AMARILLO, \" Info  \"COL_BLANCO\"Es hora de poner los puntos de control (Checkpoint's), pulsa ~k~~VEHICLE_FIREWEAPON~ para ello.\");\n\t        SendClientMessage(playerid, COLOR_AMARILLO, \" Info  \"COL_BLANCO\"Cuando termines de colocarlos presiona ~k~~VEHICLE_ENTER_EXIT~, si no reacciona, presionalo nuevamente.\");\n\t\t\tBuildCheckPointCount = 0;\n\t        BuildTakeCheckpoints = true;\n\t    }\n\t    case 606:\n\t    {\n\t        if(!response) return MostrarDialogo(playerid, 606);\n\t        BuildRace = 0;\n   \t        BuildModeVID = -1;\n\t        BuildCheckPointCount = 0;\n\t        BuildVehPosCount = 0;\n\t        BuildTakeCheckpoints = false;\n\t        BuildTakeVehPos = false;\n\t    }\n\n    }\n    return 1;\n}\n\n// ---- Comandos ----\nCMD:cpanel(playerid,params[])\n{\n\tif(!IsPlayerAdmin(playerid)) return SendClientMessage(playerid,COLOR_ROJO,\" Error  \"COL_BLANCO\"Solo el dueo puede usar este comando.\");\n    new str[1000], crear[30], detener[40], iniciar[30], permitir[30];\n    crear = BuildRace == 0 ? (\"\"COL_VERDE\"Puede crearse\") : (\"\"COL_ROJO\"No puede crearse\"); detener = RaceBusy == 0x00 ? (\"\"COL_ROJO\"No hay carreras activas\") : (\"\"COL_VERDE\"Detener\");\n    iniciar = RaceBusy == 0x00 ? (\"\"COL_VERDE\"Iniciar\") : (\"\"COL_ROJO\"Ya hay una carrera activa\"); permitir = SRaces == false ? (\"\"COL_ROJO\"Desactivado\") : (\"\"COL_VERDE\"Activado\");\n\n    format(str, sizeof(str), \"Nombre\\tEstado\\\n\t\\n Permitir carrera\\t%s\\\n\t\\n Detener Carrera\\t%s\\\n\t\\n Iniciar una Carrera\\t%s\\\n\t\\n Crear una Carrera\\t%s\",permitir, detener, iniciar, crear);\n    ShowPlayerDialog(playerid,DIALOGO_SERVER_DATOS,DIALOG_STYLE_TABLIST_HEADERS, \" Panel del carreras \", str, \"Seleccionar\",\"Cerrar\");\n    PlayerPlaySound(playerid,1139,0.0,0.0,0.0);\n    return 1;\n}\n\nCMD:crearcarrera(playerid)\n{\n    if(!IsPlayerAdmin(playerid)) return SendClientMessage(playerid,COLOR_ROJO,\" Error  \"COL_BLANCO\"Solo el dueo puede usar este comando.\");\n\tif(BuildRace != 0) return SendClientMessage(playerid, COLOR_ROJO, \" Error  \"COL_BLANCO\"Alguien est construyendo una carrera.\");\n\tif(RaceBusy == 0x01) return SendClientMessage(playerid, COLOR_ROJO, \" Error  \"COL_BLANCO\"Espere primero hasta que termine la carrera.\");\n\tif(IsPlayerInAnyVehicle(playerid)) return SendClientMessage(playerid,COLOR_ROJO,\" Error  \"COL_BLANCO\"Primero debes salir de tu vehculo.\");\n\tBuildRace = playerid+1;\n\tMostrarDialogo(playerid, 599);\n\treturn 1;\n}\n\nCMD:detenercarrera(playerid)\n{\n    if(!IsPlayerAdmin(playerid)) return SendClientMessage(playerid,COLOR_ROJO,\" Error  \"COL_BLANCO\"Solo el dueo puede usar este comando.\");\n    if(RaceBusy == 0x00 || RaceStarted == 0) return SendClientMessage(playerid, COLOR_ROJO, \" Error  \"COL_BLANCO\"No hay carrera en curso.\");\n    SendClientMessageToAllEx(COLOR_AMARILLO, \" Info  \"COL_BLANCO\"El administrador %s(ID:%d) detuvo la carrera %s.\", pName(playerid),playerid,RaceName);\n    DetenerCarrera();\n\treturn 1;\n}\n\nCMD:iniciarcarrera(playerid)\n{\n\tif(!IsPlayerAdmin(playerid)) return SendClientMessage(playerid,COLOR_ROJO,\" Error  \"COL_BLANCO\"Solo el dueo puede usar este comando.\");\n    if(SRaces == false) return SendClientMessage(playerid, COLOR_ROJO, \" Error  \"COL_BLANCO\"Las carreras fueron desactivadas por un administrador.\");\n    if(BuildRace != 0) return SendClientMessage(playerid, COLOR_ROJO, \" Error  \"COL_BLANCO\"Alguien est construyendo una carrera.\");\n    if(RaceBusy == 0x01 || RaceStarted > 0) return SendClientMessage(playerid, COLOR_ROJO, \" Error  \"COL_BLANCO\"Hay una carrera en curso, espera a que termine.\");\n\n\tnew string[138], DBResult:qresult;\n\tformat(string, sizeof(string), \"SELECT `NOMBRE`,`MODELO_VEHICULO`,`TIPO_CARRERA` FROM `CARRERA` ORDER BY (`ID_CARRERA` * 1) ASC limit 20 OFFSET %d\",Usuario[playerid][Consulta]);\n\tqresult = db_query(ZLDB, string);\n\n\tif(!db_num_rows(qresult))\n\t{\n\t    Usuario[playerid][Consulta] = 0;\n\t\tdb_free_result(qresult);\n\t\tSendClientMessage(playerid,COLOR_ROJO,\" Error  \"COL_BLANCO\"No existen ms carreras.\");\n\t\treturn 1;\n\t}\n\tnew final_string[1600], Nombre[50], RaceIDV, RaceTipo, PNombre[11];\n\tstrcat(final_string, \"Nombre\\tVehculo\\tTipo de carrera\\n\");\n\tdo\n\t{\n\t\tdb_get_field_assoc(qresult, \"NOMBRE\", Nombre, 50);\n\t\tRaceIDV = db_get_field_assoc_int(qresult, \"MODELO_VEHICULO\");\n\t\tRaceTipo = db_get_field_assoc_int(qresult, \"TIPO_CARRERA\");\n\t\tPNombre = RaceTipo == 0 ? (\"Terrestre\") : (\"Area\");\n\n\t    format(final_string,sizeof(final_string),\"%s\\n%s\\t%s\\t%s\\n\",final_string, Nombre, GetVehicleName(RaceIDV), PNombre);\n\t}\n\twhile(db_next_row(qresult));\n    ShowPlayerDialog(playerid,DIALOGO_MAS_CARRERAS, DIALOG_STYLE_TABLIST_HEADERS, \" Lista de Carreras \", final_string, \"Seleccionar\", \"+ Carreras\");\n    return 1;\n}\n\nCMD:unirme(playerid, params[])\n{\n\tif(RaceStarted > 0) return SendClientMessage(playerid,COLOR_ROJO, \" Error  \"COL_BLANCO\"Ya ha empezado la carrera, espera a que termine y empieze otro.\");\n\tif(RaceBusy == 0x00) return SendClientMessage(playerid,COLOR_ROJO, \" Error  \"COL_BLANCO\"No hay ninguna carrera actualmente.\");\n\tif(Usuario[playerid][EsCorredor] == true) return SendClientMessage(playerid, COLOR_ROJO, \" Error  \"COL_BLANCO\"Ya ests en la carrera.\");\n\tif(IsPlayerInAnyVehicle(playerid)) return defer SetupRaceForPlayerTimer[2500](playerid), RemovePlayerFromVehicle(playerid), Usuario[playerid][EsCorredor] = true;\n\tSetupRaceForPlayer(playerid);\n\tUsuario[playerid][EsCorredor] = true;\n\treturn 1;\n}\n\nCMD:salir(playerid, params[])\n{\n    if(Usuario[playerid][EsCorredor] == false) return SendClientMessage(playerid, COLOR_ROJO, \" Error  \"COL_BLANCO\"No ests en la carrera.\");\n    if(RaceStarted != 2) return SendClientMessage(playerid,COLOR_ROJO, \" Error  \"COL_BLANCO\"An no ha empezado la carrera, espera a que comienze.\");\n    JoinCount--;\n\tUsuario[playerid][EsCorredor] = false;\n\tSetVehicleHealth(GetPlayerVehicleID(playerid),1250.0);\n\tDisableRemoteVehicleCollisions(playerid,0);\n \tDisablePlayerRaceCheckpoint(playerid);\n\tPlayerTextDrawHide(playerid, RaceInfoText);\n\tUsuario[playerid][CPProgess] = 0;\n\tstop Usuario[playerid][InfoTimer];\n\tTogglePlayerControllable(playerid, true);\n\tSetCameraBehindPlayer(playerid);\n\tSetPlayerVirtualWorld(playerid, 0);\n\tSendClientMessageToAllEx(COLOR_AMARILLO, \" Info  \"COL_BLANCO\"El jugador %s ha salido de la carrera (razn: Quiso salirse)\",pName(playerid));\n\treturn 1;\n}\n\n// ---- Funciones, Stocks y timers ----\nTextosDePantalla()\n{\n\tEmpezarCarrera = TextDrawCreate(320.800018, 389.759979, \"_\");\n\tTextDrawLetterSize(EmpezarCarrera, 0.213996, 1.726933);\n\tTextDrawTextSize(EmpezarCarrera, 667.024597, 336.746276);\n\tTextDrawAlignment(EmpezarCarrera, 2);\n\tTextDrawColor(EmpezarCarrera, -1);\n\tTextDrawUseBox(EmpezarCarrera, true);\n\tTextDrawBoxColor(EmpezarCarrera, 1027423573);\n\tTextDrawSetShadow(EmpezarCarrera, 0);\n\tTextDrawSetOutline(EmpezarCarrera, 1);\n\tTextDrawBackgroundColor(EmpezarCarrera, 51);\n\tTextDrawFont(EmpezarCarrera, 2);\n\tTextDrawSetProportional(EmpezarCarrera, 1);\n\treturn 1;\n}\n\nTextosDePantallaPlayer(playerid)\n{\n\tRaceInfoText = CreatePlayerTextDraw(playerid, 320.800018, 389.759979, \"_\");\n\tPlayerTextDrawLetterSize(playerid, RaceInfoText, 0.213994, 1.726933);\n\tPlayerTextDrawTextSize(playerid, RaceInfoText, 878.225036, 383.786315);\n\tPlayerTextDrawAlignment(playerid, RaceInfoText, 2);\n\tPlayerTextDrawColor(playerid, RaceInfoText, -1);\n\tPlayerTextDrawUseBox(playerid, RaceInfoText, true);\n\tPlayerTextDrawBoxColor(playerid, RaceInfoText, 1027423573);\n\tPlayerTextDrawSetShadow(playerid, RaceInfoText, 0);\n\tPlayerTextDrawSetOutline(playerid, RaceInfoText, 1);\n\tPlayerTextDrawBackgroundColor(playerid, RaceInfoText, 51);\n\tPlayerTextDrawFont(playerid, RaceInfoText, 2);\n\tPlayerTextDrawSetProportional(playerid, RaceInfoText, 1);\n    return 1;\n}\n\nGuardarScoreFreeRoam(playerid)\n{\n\tprintf(\"[DEBUG] ScoreFreeroam de %s guardado\",pName(playerid));\n/*    static Query[100];\n    format(Query,sizeof(Query),\"UPDATE `USERS` SET SCOREFREEROAM = '%d' WHERE `ID` = '%d' COLLATE NOCASE\",GetPlayerScore(playerid),Usuario[playerid][pID]);\n    db_query(ZLDB, Query);*/\n    return 1;\n}\n\nGuardarScoreRace(playerid)\n{\n    printf(\"[DEBUG] ScoreRace de %s guardado\",pName(playerid));\n/*    static Query[100];\n    format(Query,sizeof(Query),\"UPDATE `USERS` SET SCORERACE = '%d' WHERE `ID` = '%d' COLLATE NOCASE\",Usuario[playerid][ScoreCarrera],Usuario[playerid][pID]);\n    db_query(ZLDB, Query);*/\n    return 1;\n}\n\nCrearVehiculo(playerid,model)\n{\n\tif(IsPlayerInAnyVehicle(playerid)) RemovePlayerFromVehicle(playerid);\n\n\tnew Float:Pos[4];\n \tGetPlayerPos(playerid,Pos[0],Pos[1],Pos[2]);\n \tGetPlayerFacingAngle(playerid,Pos[3]);\n\tif(Usuario[playerid][Vehiculo] != -1) DestruirVehiculo(playerid,Usuario[playerid][Vehiculo]);\n    new vehicleid = AddStaticVehicleEx(model,Pos[0],Pos[1],Pos[2],Pos[3],random(255),random(255), -1);\n\tSetVehicleVirtualWorld(vehicleid,GetPlayerVirtualWorld(playerid));\n\tLinkVehicleToInterior(vehicleid,GetPlayerInterior(playerid));\n\tPutPlayerInVehicle(playerid,vehicleid,0);\n    Usuario[playerid][Vehiculo] = vehicleid;\n    SendClientMessageEx(playerid,COLOR_AMARILLO, \" Info  \"COL_BLANCO\"Has aparecido un \"COL_AMARILLO\"%s [Modelo: %d]\",GetVehicleName(model),model);\n\treturn vehicleid;\n}\n\nCrearVehiculoEx(playerid, model, Float:x, Float:y, Float:z, Float:angle)\n{\n\tif(Usuario[playerid][Vehiculo] != -1) DestruirVehiculo(playerid,Usuario[playerid][Vehiculo]);\n\n    new vehicleid = AddStaticVehicleEx(model,x,y,z,angle,random(255),random(255),(60 * 60));\n    SetPlayerPos(playerid, x,y,z);\n\tSetPlayerFacingAngle(playerid, angle);\n\tPutPlayerInVehicle(playerid,vehicleid,0);\n\tSetPlayerVirtualWorld(playerid, 11);\n    SetVehicleVirtualWorld(vehicleid,11);\n    Usuario[playerid][Vehiculo] = vehicleid;\n    SetPlayerInterior(playerid,0);\n\treturn vehicleid;\n}\n\nDestruirVehiculo(playerid,vehicleid)\n{\n\tif(vehicleid != -1)\n\t{\n\t\tnew Float:Pos[3];\n\t    foreach(new i : Player)\n\t\t{\n\t\t    if(IsPlayerInVehicle(i, vehicleid))\n\t\t\t{\n\t\t\t\tGetPlayerPos(i,Pos[0],Pos[1],Pos[2]);\n\t\t\t\tSetPlayerPos(i,Pos[0],Pos[1]+3,Pos[2]);\n\t\t\t}\n\t\t}\n\t\tUsuario[playerid][Vehiculo] = -1;\n\t\tDestroyVehicle(vehicleid);\n\t}\n\treturn 1;\n}\n\nTimeConvert(seconds)\n{\n\tnew tmp[16];\n \tnew minutes = floatround(seconds/60);\n  \tseconds -= minutes*60;\n   \tformat(tmp, sizeof(tmp), \"%d:%02d\", minutes, seconds);\n   \treturn tmp;\n}\n\nstock SendClientMessageEx(playerid, colour, const fmat[],  va_args<>)\n{\n\tnew str[175];\n\tva_format(str, sizeof (str), fmat, va_start<3>);\n\treturn SendClientMessage(playerid, colour, str);\n}\n\nstock SendClientMessageToAllEx(colour, const fmat[], va_args<>)\n{\n\tnew str[175];\n\tva_format(str, sizeof (str), fmat, va_start<2>);\n\treturn SendClientMessageToAll(colour, str);\n}\n\nstock pName(playerid)\n{\n    new name[24];\n    GetPlayerName(playerid, name, 24);\n    return name;\n}\n\ntimer Descongelar[100](playerid)\n{\n    TogglePlayerControllable(playerid,true);\n    return 1;\n}\n\ntimer DarAuto[100](playerid)\n{\n    CrearVehiculo(playerid, RaceVehicle);\n    return 1;\n}\n\nCallBack: LoadRace(playerid, IDRace)\n{\n\tif(!ExisteCarrera(IDRace)) return SendClientMessage(playerid, COLOR_ROJO, \" Error  \"COL_BLANCO\"Esta carrera no existe.\");\n\tstatic Query[100], By1[35], DBResult: qresult;\n    format(Query, sizeof(Query), \"SELECT `NOMBRE` FROM `CARRERA` WHERE `ID_CARRERA` = '%d' COLLATE NOCASE\", IDRace);\n\tqresult = db_query(ZLDB, Query);\n\tif(db_num_rows(qresult))\n    {\n\t    db_get_field_assoc(qresult, \"NOMBRE\", By1, sizeof(By1));\n\t \tstrmid(RaceName, By1, 0, strlen(By1), sizeof(RaceName));\n\t}\n    db_free_result(qresult);\n\tCargarDatosCarrera(IDRace, RaceVehicle, RaceType);\n\tTotalCP = ContarPuntosControl(IDRace);\n\n\tLoop(x, 2)\n\t{\n\t\tCargarPosicionCarrera(IDRace, x, RaceVehCoords[x][0], RaceVehCoords[x][1], RaceVehCoords[x][2], RaceVehCoords[x][3]);\n\t}\n\tLoop(x, TotalCP)\n\t{\n \t\tCargarPuntosDeControl(IDRace, x, CPCoords[x][0], CPCoords[x][1], CPCoords[x][2]);\n\t}\n\tPosition = 0;\n\tFinishCount = 0;\n\tJoinCount = 0;\n\tLoop(x, 2) PlayersCount[x] = 0;\n\t//Usuario[playerid][EsCorredor] = true;\n\tCountAmountRace = CONTEO_INICIA_CARRERA;\n\tRaceTime = MAX_TIEMPO_CARRERA;\n\tRaceBusy = 0x01;\n\tTimeProgress = 0;\n\tCountTimer = repeat CountTillRace();\n    SendClientMessageToAllEx(COLOR_AMARILLO,\" Info  \"COL_BLANCO\"El administrador %s(ID:%d) ha iniciado una carrera.\",pName(playerid),playerid);\n    //SetupRaceForPlayer(playerid);\n\treturn 1;\n}\n\nCallBack: SetCP(playerid, PrevCP, NextCP, MaxCP, Type)\n{\n\tif(Type == 0)\n\t{\n\t\tif(NextCP == MaxCP) SetPlayerRaceCheckpoint(playerid, 1, CPCoords[PrevCP][0], CPCoords[PrevCP][1], CPCoords[PrevCP][2], CPCoords[NextCP][0], CPCoords[NextCP][1], CPCoords[NextCP][2], CARRERA_CP_TAMAO);\n\t\t\telse SetPlayerRaceCheckpoint(playerid, 0, CPCoords[PrevCP][0], CPCoords[PrevCP][1], CPCoords[PrevCP][2], CPCoords[NextCP][0], CPCoords[NextCP][1], CPCoords[NextCP][2], CARRERA_CP_TAMAO);\n\t}\n\telse if(Type == 3)\n\t{\n\t\tif(NextCP == MaxCP) SetPlayerRaceCheckpoint(playerid, 4, CPCoords[PrevCP][0], CPCoords[PrevCP][1], CPCoords[PrevCP][2], CPCoords[NextCP][0], CPCoords[NextCP][1], CPCoords[NextCP][2], CARRERA_CP_TAMAO);\n\t\t\telse SetPlayerRaceCheckpoint(playerid, 3, CPCoords[PrevCP][0], CPCoords[PrevCP][1], CPCoords[PrevCP][2], CPCoords[NextCP][0], CPCoords[NextCP][1], CPCoords[NextCP][2], CARRERA_CP_TAMAO);\n\t}\n\treturn 1;\n}\n\ntimer SetupRaceForPlayerTimer[100](playerid)\n{\n    SetupRaceForPlayer(playerid);\n    return 1;\n}\n\nCallBack: SetupRaceForPlayer(playerid)\n{\n    SendClientMessageToAllEx(COLOR_AZUL,\" carrera  \"COL_BLANCO\"%s(ID:%d) ha entrado a la carrera.\",pName(playerid),playerid);\n\tUsuario[playerid][CPProgess] = 0;\n\tTogglePlayerControllable(playerid, false);\n\tCPCoords[playerid][3] = 0;\n\tSetCP(playerid, Usuario[playerid][CPProgess], Usuario[playerid][CPProgess]+1, TotalCP, RaceType);\n\tif(IsOdd(playerid)) Index = 1;\n\t    else Index = 0;\n\n\tswitch(Index)\n\t{\n\t\tcase 0:\n\t\t{\n\t\t    if(PlayersCount[0] == 1)\n\t\t    {\n\t\t\t\tRaceVehCoords[0][0] -= (6 * floatsin(-RaceVehCoords[0][3], degrees));\n\t\t \t\tRaceVehCoords[0][1] -= (6 * floatcos(-RaceVehCoords[0][3], degrees));\n  \t\t \t\tCrearVehiculoEx(playerid, RaceVehicle, RaceVehCoords[0][0], RaceVehCoords[0][1], RaceVehCoords[0][2]+2, RaceVehCoords[0][3]);\n\t\t\t\tCamera(playerid, RaceVehCoords[0][0], RaceVehCoords[0][1], RaceVehCoords[0][2], RaceVehCoords[0][3], 20);\n\t\t\t}\n\t\t}\n\t\tcase 1:\n \t\t{\n \t\t    if(PlayersCount[1] == 1)\n \t\t    {\n\t\t\t\tRaceVehCoords[1][0] -= (6 * floatsin(-RaceVehCoords[1][3], degrees));\n\t\t \t\tRaceVehCoords[1][1] -= (6 * floatcos(-RaceVehCoords[1][3], degrees));\n\t\t   \t\tCrearVehiculoEx(playerid, RaceVehicle, RaceVehCoords[1][0], RaceVehCoords[1][1], RaceVehCoords[1][2]+2, RaceVehCoords[1][3]);\n\t\t\t\tCamera(playerid, RaceVehCoords[1][0], RaceVehCoords[1][1], RaceVehCoords[1][2], RaceVehCoords[1][3], 20);\n    \t\t}\n \t\t}\n\t}\n\tswitch(Index)\n\t{\n\t    case 0:\n\t\t{\n\t\t\tif(PlayersCount[0] != 1)\n\t\t\t{\n\t\t   \t\tCrearVehiculoEx(playerid, RaceVehicle, RaceVehCoords[0][0], RaceVehCoords[0][1], RaceVehCoords[0][2]+2, RaceVehCoords[0][3]);\n\t\t\t\tCamera(playerid, RaceVehCoords[0][0], RaceVehCoords[0][1], RaceVehCoords[0][2], RaceVehCoords[0][3], 20);\n\t\t\t    PlayersCount[0] = 1;\n\t\t    }\n\t    }\n\t    case 1:\n\t    {\n\t\t\tif(PlayersCount[1] != 1)\n\t\t\t{\n\t\t   \t\tCrearVehiculoEx(playerid, RaceVehicle, RaceVehCoords[1][0], RaceVehCoords[1][1], RaceVehCoords[1][2]+2, RaceVehCoords[1][3]);\n\t\t\t\tCamera(playerid, RaceVehCoords[1][0], RaceVehCoords[1][1], RaceVehCoords[1][2], RaceVehCoords[1][3], 20);\n\t\t\t\tPlayersCount[1] = 1;\n\t\t    }\n   \t\t}\n\t}\n\tUsuario[playerid][InfoTimer] = repeat TextInfo[200](playerid);\n\tJoinCount++;\n\treturn 1;\n}\n\ntimer CountTillRace[1000]()\n{\n\tnew string2[200];\n    format(string2,sizeof(string2),\"Faltan ~b~%d ~w~segundos para iniciar la carrera: ~b~%s~n~~w~Para ingresar escribe /unirme, corredores totales: %d\",CountAmountRace-5, RaceName, JoinCount);\n    TextDrawSetString(EmpezarCarrera, string2);TextDrawShowForAll(EmpezarCarrera);\n\n\tif(CountAmountRace <= 5)\n\t{\n\t\tTextDrawHideForAll(EmpezarCarrera);\n\t\tRaceStarted = 1;\n\t \tnew string[10];\n\t\tformat(string, sizeof(string), \"~b~%d\", CountAmountRace);\n\t\tforeach(new i : Player) if(Usuario[i][EsCorredor] == true)\n\t\t{\n\t\t  \tGameTextForPlayer(i, string, 999, 5);\n\t\t  \tPlayerPlaySound(i, 1056, 0.0, 0.0, 0.0);\n\t\t  \tPlayerTextDrawShow(i, RaceInfoText);\n\t  \t}\n\t}\n\tif(CountAmountRace <= 0) StartRace();\n\treturn CountAmountRace--;\n}\n\nCallBack: StartRace()\n{\n    stop CountTimer;\n    if(JoinCount < 0) return DetenerCarrera(), SendClientMessageToAll(COLOR_AMARILLO, \" Info  \"COL_BLANCO\"Carrera cancelada. [Razn: No haba suficientes jugadores]\");\n\tforeach(new i : Player)\n\t{\n\t    if(Usuario[i][EsCorredor] == true)\n\t    {\n\t        TogglePlayerControllable(i, true);\n\t        PlayerPlaySound(i, 1057, 0.0, 0.0, 0.0);\n  \t\t\tGameTextForPlayer(i, \"~g~GO GO GO\", 2000, 5);\n\t\t\tSetCameraBehindPlayer(i);\n\t\t\tDisableRemoteVehicleCollisions(i,1);\n\t\t\tResetPlayerWeapons(i);\n\t    }\n\t}\n\trCounter = repeat RaceCounter();\n\tRaceTick = GetTickCount();\n\tRaceStarted = 2;\n\treturn 1;\n}\n\nCallBack: DetenerCarrera()\n{\n\tstop rCounter;\n\tRaceStarted = 0;\n\tRaceTick = 0;\n\tRaceBusy = 0x00;\n\tJoinCount = 0;\n\tFinishCount = 0;\n    TimeProgress = 0;\n\n\tforeach(new i : Player)\n\t{\n\t    if(Usuario[i][EsCorredor] == true)\n\t    {\n\t    \tDisablePlayerRaceCheckpoint(i);\n\t    \tUsuario[i][EsCorredor] = false;\n\t    \tSetVehicleHealth(GetPlayerVehicleID(i),1250.0);\n\t    \tSpawnPlayer(i);\n\t\t\tPlayerTextDrawHide(i, RaceInfoText);\n\t\t\tDisableRemoteVehicleCollisions(i,0);\n\t\t\tUsuario[i][CPProgess] = 0;\n\t\t\tstop Usuario[i][InfoTimer];\n\t\t}\n\t}\n\n\tfor(new i;i<MAX_CP_POR_CARRERA;i++)\n\t{\n\t    CPCoords[i][0]=0.0;\n\t    CPCoords[i][1]=0.0;\n\t    CPCoords[i][2]=0.0;\n\t    CPCoords[i][3]=0.0;\n\t}\n\tforeach(new i : Player)\n\t{\n\t    Usuario[i][CPProgess] = 0;\n\t    CPCoords[i][3] = 0;\n\t}\n\treturn 1;\n}\n\ntimer RaceCounter[1000]()\n{\n\tif(RaceStarted == 2)\n\t{\n\t\tRaceTime--;\n\t\tif(JoinCount <= 0)\n\t\t{\n\t\t\tDetenerCarrera();\n\t\t\tSendClientMessageToAll(COLOR_AMARILLO, \" Info  \"COL_BLANCO\"Carrera terminada, no hay corredores.\");\n\t\t}\n\t}\n\tif(RaceTime <= 0)\n\t{\n\t    DetenerCarrera();\n\t    SendClientMessageToAll(COLOR_AMARILLO, \" Info  \"COL_BLANCO\"Carrera terminada, se acab el tiempo.\");\n\t}\n\treturn 1;\n}\n\ntimer TextInfo[200](playerid)\n{\n\tnew string[200];\n\tif(JoinCount == 1)\n\t\tformat(string, sizeof(string), \"Puntos de control: ~b~%d~y~/~b~%d ~w~Tiempo: ~b~%s ~y~- ~w~Posicin: ~b~1~y~/~b~1\", Usuario[playerid][CPProgess], TotalCP, TimeConvert(RaceTime));\n    else\n\t\tformat(string, sizeof(string), \"Puntos de control: ~b~%d~y~/~b~%d ~w~Tiempo: ~b~%s ~y~- ~w~Posicin: ~b~%d~y~/~b~%d\", Usuario[playerid][CPProgess], TotalCP, TimeConvert(RaceTime), Usuario[playerid][PosicionCarrera], JoinCount);\n\tPlayerTextDrawSetString(playerid,RaceInfoText,string);\n}\n\nCallBack: Camera(playerid, Float:X, Float:Y, Float:Z, Float:A, Mul)\n{\n\tSetPlayerCameraLookAt(playerid, X, Y, Z);\n\tSetPlayerCameraPos(playerid, X + (Mul * floatsin(-A, degrees)), Y + (Mul * floatcos(-A, degrees)), Z+6);\n}\n\nCallBack: MostrarDialogo(playerid, dialogid)\n{\n\tswitch(dialogid)\n\t{\n\t\tcase 599: ShowPlayerDialog(playerid, dialogid, DIALOG_STYLE_LIST, \"Crear una carrera - (Inicio)\", \"\\\n\t\tCarrera Normal\\n\\\n\t\tCarrera por Aire\", \"Siguiente\", \"Salir\");\n\n\t    case 600: ShowPlayerDialog(playerid, dialogid, DIALOG_STYLE_INPUT, \"Crear una carrera (Paso 1/4)\", \"\\\n\t\t{FFFFFF}Paso #1:\\n\\\n \t\tBienvenido a la herramienta para crear una nueva carrera.\\n\\\n\t\tAntes de empezar necesito que escribas el nombre de la carrera, (ejemplo: Mi_Carrera1)\\n\\\n\t\t{FF0000}NOTA: {FFFFFF}El nombre debe ser menor a 20 y mayor que 5\",\\\n\t\t\"Siguiente\", \"Atrs\");\n\n\t    case 601: ShowPlayerDialog(playerid, dialogid, DIALOG_STYLE_INPUT, \"Crear una carrera (Paso 1/4)\", \"\\\n\t    {FF0000}ERROR: {FFFFFF}El nombre de la carrera es muy largo o muy corto (mnimo 5 - mximo 20)\\n\\n\\\n\t\t{FFFFFF}Paso #1:\\n\\\n \t\tBienvenido a la herramienta para crear una nueva carrera.\\n\\\n\t\tAntes de empezar necesito que escribas el nombre de la carrera, (ejemplo: Mi_Carrera1)\\n\\\n\t\t{FF0000}NOTA: {FFFFFF}El nombre debe ser menor a 20 y mayor que 5\",\\\n\t\t\"Siguiente\", \"Atrs\");\n\n\t\tcase 602: ShowPlayerDialog(playerid, dialogid, DIALOG_STYLE_INPUT, \"Crear una carrera (Paso 2/4)\", \"\\\n\t\t{FFFFFF}Paso #2:\\n\\\n\t\tEscribe el nombre(ejemplo: Infernus) o el ID(ejemplo: 411) del auto que ser usado en la carrera.\\n\",\\\n\t\t\"Ok\", \"Atrs\");\n\n\t\tcase 603: ShowPlayerDialog(playerid, dialogid, DIALOG_STYLE_INPUT, \"Crear una carrera (Paso 2/4)\", \"\\\n\t\t{FF0000}ERROR: {FFFFFF}El nombre o el ID del auto es invlido\\n\\n\\\n\t\t{FFFFFF}Paso #2:\\n\\\n\t\tEscribe el nombre(ejemplo: Infernus) o el ID(ejemplo: 411) del auto que ser usado en la carrera.\\n\",\\\n\t\t\"Ok\", \"Atrs\");\n\n\t\tcase 604: ShowPlayerDialog(playerid, dialogid, DIALOG_STYLE_MSGBOX, \"Crear una carrera (Paso 3/4)\", \"\\\n\t\t{FFFFFF}Paso #3:\\n\\\n\t\tVe a la lnea de meta y elige la posicin del primer auto y luego la del segundo.\\n\\\n\t\t{FF0000}NOTA: {FFFFFF}Cuando presiona 'Ok' sers libre de presionar 'CLIC' para colocar las posiciones.\\n\\\n\t\t{FF0000}NOTA: {FFFFFF}Despus de colocar las posiciones, vers el siguiente dialogo para continuar\\n\",\\\n\t\t\"Ok\", \"Atrs\");\n\n\t\tcase 605: ShowPlayerDialog(playerid, dialogid, DIALOG_STYLE_MSGBOX, \"Crear una carrera (Paso 4/4)\", \"\\\n\t\t{FFFFFF}Paso #4:\\n\\\n\t\tBienvenido a la ltima etapa de la construccin, en esta etapa podrs colocar los puntos de control.\\n\\\n\t\tCada vez que presiones 'CLIC' o 'CTRL' se colocar un punto de control el cual ser guardado automticamente.\\n\",\\\n\t\t\"Ok\", \"Atrs\");\n\n\t\tcase 606:\n\t\t{\n\t\t\tnew str[400];\n\t\t\tformat(str, 500, \"\"COL_BLANCO\"Has creado una carrera y est lista para ser usada.\\n\\\n\t\t\tDatos de la carrera:\\n\\\n\t\t\tNombre: \"COL_VERDE\"%s\\n\\\n\t\t\t\"COL_BLANCO\"Puntos de control: \"COL_VERDE\"%d\\n\\\n\t\t\t\"COL_BLANCO\"Vehculo: \"COL_VERDE\"%s\\n\\\n\t\t\t\"COL_BLANCO\"Tipo de carrera: \"COL_VERDE\"%s\\n\\\n\t\t\t\"COL_BLANCO\"Presiona 'Salir' para cerrar el dialogo.\",BuildName,BuildCheckPointCount,GetVehicleName(BuildModeVID),BuildRaceType == 0 ? (\"Terrestre\") : (\"Area\"));\n\t\t\tShowPlayerDialog(playerid, dialogid, DIALOG_STYLE_MSGBOX, \"Crear una carrera (Hecho)\",str, \"Salir\", \"\");\n\t\t}\n\t}\n\treturn 1;\n}\n\nstock IsValidVehicle(vehicleid)\n{\n\tif(vehicleid < 400 || vehicleid > 611) return false; else return true;\n}\n\nReturnVehicleID(vName[])\n{\n\tLoop(x, 211)\n\t{\n\t    if(strfind(g_arrVehicleNames[x], vName, true) != -1)\n\t\treturn x + 400;\n\t}\n\treturn -1;\n}\n\nGetVehicleName(model)\n{\n\tnew name[32] = \"None\";\n\tif (model < 400 || model > 611) return name;\n\n\tformat(name, sizeof(name), g_arrVehicleNames[model - 400]);\n\treturn name;\n}\n\nAlmacenarTiempoCarrera(nombreCarrera[], posicionLlegada, tiempoCarrera, nombreCorredor)\n{\n\tnew DB:bd = db_open(sql_database);\n\n\tif(bd)\n\t{\n\t\tnew consulta[256];\n\n\t\tformat(consulta, sizeof (consulta), \"INSERT INTO TIEMPO_CARRERA\t(ID_CARRERA, NUMERO_POSICION, TIEMPO, NOMBRE_CORREDOR) \\\n\t\t\tVALUES ((SELECT ID_CARRERA FROM CARRERA WHERE NOMBRE = '%q'), %i, %i, '%d')\", nombreCarrera, posicionLlegada, tiempoCarrera, nombreCorredor);\n\t\tdb_free_result(db_query(bd, consulta));\n\t\tdb_close(bd);\n\t}\n}\n\nActualizarTiempoCarrera(nombreCarrera[], posicionLlegada, tiempoCarrera, nombreCorredor)\n{\n\tnew DB:bd = db_open(sql_database);\n\n\tif(bd)\n\t{\n\t\tnew consulta[256];\n\n\t\tformat(consulta, sizeof (consulta), \"UPDATE TIEMPO_CARRERA SET TIEMPO = %i, NOMBRE_CORREDOR = '%d' WHERE ID_CARRERA = \\\n\t\t\t(SELECT ID_CARRERA FROM CARRERA WHERE NOMBRE = '%q') AND NUMERO_POSICION = %i\", tiempoCarrera, nombreCorredor, nombreCarrera, posicionLlegada);\n\n\t\tdb_free_result(db_query(bd, consulta));\n\t\tdb_close(bd);\n\t}\n}\n\nEsTiempoRecord(nombreCarrera[], posicionLlegada, tiempoCarrera)\n{\n\tnew DB:bd = db_open(sql_database), bool:esTiempoRecord = false;\n\n\tif(bd)\n\t{\n\t\tnew consulta[256], DBResult:resultado;\n\n\t\tformat(consulta, sizeof (consulta), \"SELECT 1 FROM TIEMPO_CARRERA WHERE ID_CARRERA = (SELECT ID_CARRERA FROM CARRERA WHERE NOMBRE = '%q') \\\n\t\t\tAND NUMERO_POSICION = %i AND TIEMPO < %i LIMIT 1\", nombreCarrera, posicionLlegada, tiempoCarrera);\n\t\tresultado = db_query(bd, consulta);\n\n\t\tesTiempoRecord = db_num_rows(resultado) == 0;\n\t\tdb_free_result(resultado);\n\t\tdb_close(bd);\n\t}\n\treturn esTiempoRecord;\n}\n\nHayTiemposRegistrados(nombreCarrera[], posicionLlegada)\n{\n\tnew DB:bd = db_open(sql_database), bool:hayTiemposRegistrados = true;\n\n\tif(bd)\n\t{\n\t\tnew consulta[168], DBResult:resultado;\n\n\t\tformat(consulta, sizeof (consulta), \"SELECT 1 FROM TIEMPO_CARRERA WHERE ID_CARRERA = (SELECT ID_CARRERA FROM CARRERA WHERE NOMBRE = '%q') AND NUMERO_POSICION = %i LIMIT 1\", nombreCarrera, posicionLlegada);\n\t\tresultado = db_query(bd, consulta);\n\n\t\thayTiemposRegistrados = db_num_rows(resultado) > 0;\n\t\tdb_free_result(resultado);\n\t\tdb_close(bd);\n\t}\n\treturn hayTiemposRegistrados;\n}\n\nObtenerRecordPrevio(nombreCarrera[], posicionLlegada, tiempoCarrera, &nombreCorredorRP, &tiempoRecordPrevio)\n{\n\tnew DB:bd = db_open(sql_database);\n\n\tif (bd)\n\t{\n\t\tnew consulta[256], DBResult:resultado;\n\n\t\tformat(consulta, sizeof (consulta), \"SELECT NOMBRE_CORREDOR, TIEMPO FROM TIEMPO_CARRERA WHERE ID_CARRERA = (SELECT ID_CARRERA FROM CARRERA WHERE NOMBRE = '%q') \\\n\t\t\tAND NUMERO_POSICION = %i AND TIEMPO\t>= %i ORDER BY TIEMPO ASC LIMIT 1\", nombreCarrera, posicionLlegada, tiempoCarrera);\n\t\tresultado = db_query(bd, consulta);\n\n\t\tif (db_num_rows(resultado) > 0)\n\t\t{\n\t\t\tnombreCorredorRP = db_get_field_assoc_int(resultado, \"NOMBRE_CORREDOR\");\n\t\t\ttiempoRecordPrevio = db_get_field_assoc_int(resultado, \"TIEMPO\");\n\t\t}\n\t\tdb_free_result(resultado);\n\t\tdb_close(bd);\n\t}\n}\n/*\nObtenerRecordNombre(idCarrera, &nombreCorredorRP, &tiempoRecordPrevio)\n{\n\tnew DB:bd = db_open(sql_database);\n\n\tif(bd)\n\t{\n\t\tnew consulta[256], DBResult:resultado;\n\n\t\tformat(consulta, sizeof (consulta), \"SELECT NOMBRE_CORREDOR, TIEMPO FROM TIEMPO_CARRERA WHERE ID_CARRERA = (SELECT ID_CARRERA FROM CARRERA WHERE ID_CARRERA = '%i') \\\n\t\t\tAND NUMERO_POSICION = 1 ORDER BY TIEMPO ASC LIMIT 1\", idCarrera);\n\t\tresultado = db_query(bd, consulta);\n\n\t\tif (db_num_rows(resultado) > 0)\n\t\t{\n\t\t\tnombreCorredorRP = db_get_field_assoc_int(resultado, \"NOMBRE_CORREDOR\");\n\t\t\ttiempoRecordPrevio = db_get_field_assoc_int(resultado, \"TIEMPO\");\n\t\t}\n   \t\telse if (db_num_rows(resultado) == 0) nombreCorredorRP = 0;\n\t\tdb_free_result(resultado);\n\t\tdb_close(bd);\n\t}\n}\n*/\nstock EsNumerico(string[])\n{\n    for (new i = 0, j = strlen(string); i < j; i++)\n\t{\n        if (string[i] > '9' || string[i] < '0')\n        \treturn 0;\n    }\n    return 1;\n}\n\nBorrarCarrera(nombreCarrera[])\n{\n\tnew DB:bd = db_open(sql_database);\n\n\tif(bd)\n\t{\n\t\tnew consulta[256], DBResult:resultado;\n\n\t\tformat(consulta, sizeof (consulta), \"SELECT 1 FROM CARRERA WHERE NOMBRE = '%q' LIMIT 1\", nombreCarrera);\n\t\tresultado = db_query(bd, consulta);\n\n\t\tif(db_num_rows(resultado) > 0)\n\t\t{\n\t\t\tformat(consulta, sizeof (consulta), \"DELETE FROM TIEMPO_CARRERA\tWHERE ID_CARRERA = (SELECT ID_CARRERA FROM CARRERA WHERE NOMBRE = '%q')\", nombreCarrera);\n\t\t\tdb_free_result(db_query(bd, consulta));\n\n\t\t\tformat(consulta, sizeof (consulta), \"DELETE FROM PUNTO_CONTROL_CARRERA WHERE ID_CARRERA = (SELECT ID_CARRERA FROM CARRERA WHERE NOMBRE = '%q')\", nombreCarrera);\n\t\t\tdb_free_result(db_query(bd, consulta));\n\n\t\t\tformat(consulta, sizeof (consulta), \"DELETE FROM POSICION_PARTIDA_CARRERA WHERE ID_CARRERA = (SELECT ID_CARRERA\tFROM CARRERA WHERE NOMBRE = '%q')\", nombreCarrera);\n\t\t\tdb_free_result(db_query(bd, consulta));\n\n\t\t\tformat(consulta, sizeof (consulta), \"DELETE FROM CARRERA WHERE NOMBRE = '%q'\", nombreCarrera);\n\t\t\tdb_free_result(db_query(bd, consulta));\n\t\t}\n\t\tdb_free_result(resultado);\n\t\tdb_free_result(db_query(bd, consulta));\n\t\tdb_close(bd);\n\t}\n}\n\n\nAgregarCarrera(nombreCarrera[], modeloVehiculo, tipoCarrera)\n{\n\tnew DB:bd = db_open(sql_database);\n\n\tif(bd)\n\t{\n\t\tnew consulta[256], DBResult:resultado;\n\n\t\tformat(consulta, sizeof (consulta), \"SELECT 1 FROM CARRERA WHERE NOMBRE = '%q' LIMIT 1\", nombreCarrera);\n\t\tresultado = db_query(bd, consulta);\n\n\t\tif(db_num_rows(resultado) > 0)\n\t\t{\n\t\t\tformat(consulta, sizeof (consulta), \"DELETE FROM TIEMPO_CARRERA\tWHERE ID_CARRERA = (SELECT ID_CARRERA FROM CARRERA WHERE NOMBRE = '%q')\", nombreCarrera);\n\t\t\tdb_free_result(db_query(bd, consulta));\n\n\t\t\tformat(consulta, sizeof (consulta), \"DELETE FROM PUNTO_CONTROL_CARRERA WHERE ID_CARRERA = (SELECT ID_CARRERA FROM CARRERA WHERE NOMBRE = '%q')\", nombreCarrera);\n\t\t\tdb_free_result(db_query(bd, consulta));\n\n\t\t\tformat(consulta, sizeof (consulta), \"DELETE FROM POSICION_PARTIDA_CARRERA WHERE ID_CARRERA = (SELECT ID_CARRERA\tFROM CARRERA WHERE NOMBRE = '%q')\", nombreCarrera);\n\t\t\tdb_free_result(db_query(bd, consulta));\n\n\t\t\tformat(consulta, sizeof (consulta), \"DELETE FROM CARRERA WHERE NOMBRE = '%q'\", nombreCarrera);\n\t\t\tdb_free_result(db_query(bd, consulta));\n\t\t}\n\t\tformat(consulta, sizeof (consulta), \"INSERT INTO CARRERA (NOMBRE, MODELO_VEHICULO, TIPO_CARRERA) VALUES ('%q', %i, %i)\", nombreCarrera, modeloVehiculo, tipoCarrera);\n\t\tdb_free_result(resultado);\n\t\tdb_free_result(db_query(bd, consulta));\n\t\tdb_close(bd);\n\t}\n}\n\nAgregarPosicionPartida(nombreCarrera[], posicion, Float:x, Float:y, Float:z, Float:r)\n{\n\tnew DB:bd = db_open(sql_database);\n\n\tif(bd)\n\t{\n\t\tnew consulta[512];\n\n\t\tformat(consulta, sizeof (consulta), \"INSERT INTO POSICION_PARTIDA_CARRERA (ID_CARRERA, NUMERO_POSICION, COORDENADA_X, COORDENADA_Y, COORDENADA_Z, ROTACION) \\\n\t\t\tVALUES ((SELECT ID_CARRERA FROM CARRERA WHERE NOMBRE = '%q'), %i, %f, %f, %f, %f)\", nombreCarrera, posicion, x, y, z, r);\n\n\t\tdb_free_result(db_query(bd, consulta));\n\t\tdb_close(bd);\n\t}\n}\n\nAgregarPuntoControl(nombreCarrera[], numeroPuntoControl, Float:x, Float:y, Float:z)\n{\n\tnew DB:bd = db_open(sql_database);\n\n\tif(bd)\n\t{\n\t\tnew consulta[512];\n\n\t\tformat(consulta, sizeof (consulta), \"INSERT INTO PUNTO_CONTROL_CARRERA (ID_CARRERA, ID_PUNTO_CONTROL, COORDENADA_X, COORDENADA_Y, COORDENADA_Z) \\\n\t\t\tVALUES ((SELECT ID_CARRERA FROM CARRERA WHERE NOMBRE = '%q'), %i, %f, %f, %f)\", nombreCarrera, numeroPuntoControl, x, y, z);\n\n\t\tdb_free_result(db_query(bd, consulta));\n\t\tdb_close(bd);\n\t}\n}\n\nContarCarrerasAlmacenadas()\n{\n\tnew DB:bd = db_open(sql_database), numeroCarreras = 0;\n\n\tif(bd)\n\t{\n\t\tnew DBResult:resultado = db_query(bd, \"SELECT 1 FROM CARRERA\");\n\n\t\tnumeroCarreras = db_num_rows(resultado);\n\t\tdb_free_result(resultado);\n\t\tdb_close(bd);\n\t}\n\treturn numeroCarreras;\n}\n\nExisteCarrera(idCarrera)\n{\n\tnew DB:bd = db_open(sql_database), bool:existeCarrera = false;\n\n\tif(bd)\n\t{\n\t\tnew consulta[256], DBResult:resultado;\n\n\t\tformat(consulta, sizeof (consulta), \"SELECT 1 FROM CARRERA WHERE ID_CARRERA = '%d' LIMIT 1\", idCarrera);\n\t\tresultado = db_query(bd, consulta);\n\n\t\texisteCarrera = db_num_rows(resultado) > 0;\n\t\tdb_free_result(resultado);\n\t\tdb_close(bd);\n\t}\n\treturn existeCarrera;\n}\n\nCargarDatosCarrera(idCarrera, &modeloVehiculo, &tipoCarrera)\n{\n\tnew DB:bd = db_open(sql_database);\n\n\tif(bd)\n\t{\n\t\tnew consulta[256], DBResult:resultado;\n\n\t\tformat(consulta, sizeof (consulta), \"SELECT MODELO_VEHICULO, TIPO_CARRERA FROM CARRERA WHERE ID_CARRERA = '%d' LIMIT 1\", idCarrera);\n\t\tresultado = db_query(bd, consulta);\n\n\t\tif (db_num_rows(resultado))\n\t\t{\n\t\t\tmodeloVehiculo = db_get_field_assoc_int(resultado, \"MODELO_VEHICULO\");\n\t\t\ttipoCarrera = db_get_field_assoc_int(resultado, \"TIPO_CARRERA\");\n\t\t}\n\t\tdb_free_result(resultado);\n\t\tdb_close(bd);\n\t}\n}\n\nContarPuntosControl(idCarrera)\n{\n\tnew DB:bd = db_open(sql_database), numPuntosControl = 0;\n\n\tif(bd)\n\t{\n\t\tnew consulta[256], DBResult:resultado;\n\n\t\tformat(consulta, sizeof (consulta), \"SELECT 1 FROM PUNTO_CONTROL_CARRERA \\\n\t\t\tWHERE ID_CARRERA = (SELECT ID_CARRERA FROM CARRERA WHERE ID_CARRERA = '%d')\", idCarrera);\n\n\t\tresultado = db_query(bd, consulta);\n\t\tnumPuntosControl = db_num_rows(resultado);\n\t\tdb_free_result(resultado);\n\t\tdb_close(bd);\n\t}\n\treturn numPuntosControl;\n}\n\nCargarPosicionCarrera(idCarrera, posicion, &Float:coordenadaX, &Float:coordenadaY, &Float:coordenadaZ, &Float:rotacion)\n{\n\tnew DB:bd = db_open(sql_database);\n\n\tif(bd)\n\t{\n\t\tnew consulta[512], DBResult:resultado;\n\n\t\tformat(consulta, sizeof (consulta), \"SELECT COORDENADA_X, COORDENADA_Y, COORDENADA_Z, ROTACION FROM POSICION_PARTIDA_CARRERA \\\n\t\t\tWHERE ID_CARRERA = (SELECT ID_CARRERA FROM CARRERA WHERE ID_CARRERA = '%d') \\\n\t\t\tAND NUMERO_POSICION = %i LIMIT 1\", idCarrera, posicion);\n\n\t\tresultado = db_query(bd, consulta);\n\t\tif (db_num_rows(resultado))\n\t\t{\n\t\t\tcoordenadaX = db_get_field_assoc_float(resultado, \"COORDENADA_X\");\n\t\t\tcoordenadaY = db_get_field_assoc_float(resultado, \"COORDENADA_Y\");\n\t\t\tcoordenadaZ = db_get_field_assoc_float(resultado, \"COORDENADA_Z\");\n\t\t\trotacion = db_get_field_assoc_float(resultado, \"ROTACION\");\n\t\t}\n\t\tdb_free_result(resultado);\n\t\tdb_close(bd);\n\t}\n}\n\nCargarPuntosDeControl(idCarrera, idPuntoControl, &Float:coordenadaX, &Float:coordenadaY, &Float:coordenadaZ)\n{\n\tnew DB:bd = db_open(sql_database);\n\tif(bd)\n\t{\n\t\tnew consulta[512], DBResult:resultado;\n\t\tformat(consulta, sizeof (consulta), \"SELECT COORDENADA_X, COORDENADA_Y, COORDENADA_Z FROM PUNTO_CONTROL_CARRERA \\\n\t\t\tWHERE ID_CARRERA = (SELECT ID_CARRERA FROM CARRERA WHERE ID_CARRERA = '%d')\t\\\n\t\t\tAND ID_PUNTO_CONTROL = %i LIMIT 1\", idCarrera, idPuntoControl);\n\n\t\tresultado = db_query(bd, consulta);\n\t\tif (db_num_rows(resultado))\n\t\t{\n\t\t\tcoordenadaX = db_get_field_assoc_float(resultado, \"COORDENADA_X\");\n\t\t\tcoordenadaY = db_get_field_assoc_float(resultado, \"COORDENADA_Y\");\n\t\t\tcoordenadaZ = db_get_field_assoc_float(resultado, \"COORDENADA_Z\");\n\t\t}\n\t\tdb_free_result(resultado);\n\t\tdb_close(bd);\n\t}\n}",
 "title": "ssssssssssss"
}