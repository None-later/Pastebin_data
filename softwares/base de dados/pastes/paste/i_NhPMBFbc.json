{
 "espireDate": "N",
 "format": "text",
 "jSonReasons": [
  "kw_error",
  "lg_en",
  "kw_password"
 ],
 "key": "NhPMBFbc",
 "pasteDate": "Feb 18, 2018, 1:28:07 PM",
 "relevancy": 1.0,
 "relevant": false,
 "text": " public void login(final String username, final String password, final String url) {\n    \tLog.d(\"HBmobile\", \"Passed to Login\");\n    \tLog.d(\"HBmobile\", \"Passed URL - \" + url);\n    \tfinal SharedPreferences preferences = PreferenceManager.getDefaultSharedPreferences(this);\n    \tfinal Button button = (Button) findViewById(R.id.button1);\n        final EditText username2 = (EditText) findViewById(R.id.editText1);\n        final EditText password2 = (EditText) findViewById(R.id.editText2);\n        \n        if ( htuser == null ) {\n        final boolean htaccess = preferences.getBoolean(\"htcheck\", false);\n        final String htuser = preferences.getString(\"htuser\", \"\");\n        final String htpass = preferences.getString(\"htpass\", \"\");\n        }\n        Credentials creds = null;\n        if ( htaccess == true ) {\n        \tcreds = new UsernamePasswordCredentials(htuser, htpass);        \t\n        \tLog.d(\"HBmobile\", \"htaccess set - \" + creds.toString());\n        }\n        Log.d(\"HBmobile\", htuser + \" : \" + htpass);\n    \tusername2.setEnabled(false);\n\t\tpassword2.setEnabled(false);\n\t\tbutton.setEnabled(false);\n\t\t\n\t\tint response2 = 0;\n\t\tString reply = null;\n\t\t\t\n\t\t\t\tURL url2 = null;\n\t\t\t\ttry {\n\t\t\t\t\tif (username == \"TOKEN\") {\n\t\t\t\t\t\turl2 = new URL(url + \"/admin/api.php?&token=\" + password + \"&call=getHostBillversion\" );\n\t\t\t\t\t} else {\n\t\t\t\t\t\turl2 = new URL(url + \"/admin/api.php?&action=login&username=\" + username + \"&password=\" + password);\n\t\t\t\t\t}\n\t\t\t\t\tLog.d(\"HBmobile\", \"New URL\" + url2.toString());\n\t\t\t\t} catch (MalformedURLException e1) {\n\n\t\t\t\t\te1.printStackTrace();\n\t\t\t\t}\n\t\t\t\tInputStream httpcontent=null;\n\t\ttry{\n\t\t\tHttpGet httpGet = new HttpGet(url2.toURI());\n\t\t\tDefaultHttpClient httpclient = new DefaultHttpClient();\n\t\t\tif ( htaccess == true ) {\n\t\t\t\thttpclient.getCredentialsProvider().setCredentials(new AuthScope(AuthScope.ANY_HOST, AuthScope.ANY_PORT), creds);\n\t\t\t}\n\t\t\tHttpResponse response = httpclient.execute(httpGet);\n\t\t\tresponse2 = response.getStatusLine().getStatusCode();\n\t\t\tif( response2 == 404) {\n\t\t\t\tToast.makeText(getBaseContext(), \"Not a valid HostBill Address.\", Toast.LENGTH_SHORT).show();\n\t\t\t\t//loggingin.dismiss();\n\t\t\t\tAlertDialog alertDialog = new AlertDialog.Builder(main.this).create();\n\t\t\t\talertDialog.setTitle(\"Error...\");\n\t\t\t\talertDialog.setMessage(\"An invalid URL has been set.\\nPlease check the URL again.\\nError: Status Code 404\");\n\t\t\t\talertDialog.setButton(\"Ok\", new DialogInterface.OnClickListener() {\n\t\t\t\t\tpublic void onClick(DialogInterface dialog, int which) {\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\talertDialog.show();\n\t\t\t\tusername2.setEnabled(true);\n\t\t\t\tpassword2.setEnabled(true);\n    \t\t\tbutton.setEnabled(true);\n    \t\t\treply = \"blanks\";\n\t\t\t} else if (response2 == 200) {\n    \t\t\thttpcontent = response.getEntity().getContent();\n    \t\t\tBufferedReader rd = new BufferedReader(new InputStreamReader(httpcontent), 4096);\n    \t\t\tString line;\n    \t\t\tStringBuilder sb =  new StringBuilder();\n    \t\t\twhile ((line = rd.readLine()) != null) {\n    \t\t\t\t\tsb.append(line);\n    \t\t\t}\n    \t\t\trd.close();\n    \t\t\treply = new String(sb.toString());\n    \t\t\tresponse2 = response.getStatusLine().getStatusCode();\n\t\t\t} else if (response2 == 401) {\n\t\t\t\tLog.d(\"HBmobile\", \"401\");\n\t\t\t\t\n\t\t\t\tfinal Dialog dialog = new Dialog(main.this);\n\t\t\t\tdialog.setContentView(R.layout.htaccessdialog);\n\t\t\t\tdialog.setTitle(\"401 - Authorization Required.\");\n\t\t\t\tdialog.setCancelable(true);\n\t\t\t\tTextView message = (TextView) dialog.findViewById(R.id.textView3);\n\t\t\t\tfinal EditText htusername = (EditText) dialog.findViewById(R.id.editText1);\n\t\t\t\tfinal EditText htpassword = (EditText) dialog.findViewById(R.id.editText2);\n\t\t\t\t\n\t\t\t\tButton login = (Button) dialog.findViewById(R.id.button1);\n\t\t\t\tlogin.setOnClickListener(new OnClickListener() {\n\t\t\t\t\tpublic void onClick(View v) {\n\t\t\t\t\t\thtaccess = true;\n\t\t\t\t\t\thtuser = htusername.getText().toString();\n\t\t\t\t\t\thtpass = htpassword.getText().toString();\n\t\t\t\t\t\tLog.d(\"HBmobile\", htuser + \" : \" + htpass);\n\t\t\t\t\t\tlogin(username, password, url);\n\t\t\t\t\t\tdialog.dismiss();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tButton cancel = (Button) dialog.findViewById(R.id.button2);\n\t\t\t\tcancel.setOnClickListener(new OnClickListener() {\n\t\t\t\t\tpublic void onClick(View v) {\n\t\t\t\t\t\tdialog.dismiss();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tdialog.show();\n    \t\t\treply = \"blanks\";\n\t\t\t}\n\t\t\tLog.e(\"reply\", reply);\n\t\t} catch (Exception e) {\n\t\t\t//loggingin.dismiss();\n\t\t\tToast.makeText(getBaseContext(), \"Invalid URL\", Toast.LENGTH_SHORT);\n\t\t\treply = \"blanks\";\n\t\t}\n\t\tif( reply.contains(\"success\")){\n\t\t\t//loggingin.dismiss();\n\t\t\tint requestCode = 0;\n\t\t\tIntent i= new Intent(main.this, Home.class);\n\t\t\tBundle b = new Bundle();\n\t\t\tif ( username == \"TOKEN\") {\n\t\t\t\tb.putString(\"token\", password);\n\t\t\t} else {\n\t\t\t\tString token = reply.substring(reply.indexOf(\"token\"),reply.indexOf(\",\\\"call\\\"\"));\n\t\t\t\ttoken = token.substring(8);\n\t\t\t\ttoken = token.replace(\"\\\"\", \"\");\n\t\t\t\tb.putString(\"token\", token);\n\t\t\t}\n\t\t\tif ( htaccess = true ) {\n\t\t\t\tb.putBoolean(\"htaccess\", true);\n\t\t\t\tb.putString(\"htuser\", htuser);\n\t\t\t\tb.putString(\"htpass\", htpass);\n\t\t\t} else {\n\t\t\t\tb.putBoolean(\"htaccess\", false);\n\t\t\t}\n\t\t\tb.putString(\"url\", url);\n\t\t\ti.putExtras(b);\n\t\t\tstartActivityForResult(i, requestCode);\n\t\t} else if( reply.contains(\"error\")){\n\t\t\t//loggingin.dismiss();\n\t\t\tif( reply.contains(\"ip_banned_login\")){\n\t\t\t\tToast.makeText(getBaseContext(), \"Your IP has been banned.\", Toast.LENGTH_LONG).show();\n\t\t\t} else if( reply.contains(\"invalid_token_foroperation\")) {\n\t\t\t\tToast.makeText(getBaseContext(), \"Previous Session has expired.\", Toast.LENGTH_LONG).show();\n\t\t\t} else {\n    \t\t\tToast.makeText(getBaseContext(), \"Username/Password incorrect\", Toast.LENGTH_SHORT).show();\n\t\t\t}\n\t\t\t\tpreferences.edit().remove(\"HB_TOKEN\");\n    \t\t\tusername2.setEnabled(true);\n        \t\tpassword2.setEnabled(true);\n        \t\tbutton.setEnabled(true);\n\t\t} else {\n\t\t\t//loggingin.dismiss();\n\t\t\tToast.makeText(getBaseContext(), \"An unknown error occurred.\", Toast.LENGTH_LONG).show();\n\t\t\tusername2.setEnabled(true);\n    \t\tpassword2.setEnabled(true);\n    \t\tbutton.setEnabled(true);\n\t\t}\n    }",
 "title": ""
}