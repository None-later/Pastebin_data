{
 "espireDate": "N",
 "format": "php",
 "jSonReasons": [
  "kw_password",
  "kw_vulnerability",
  "lg_en",
  "kw_pass",
  "re_email",
  "kw_error",
  "re_php",
  "re_ast1",
  "re_url",
  "kw_overwrite"
 ],
 "key": "AnvW8VD5",
 "pasteDate": "Feb 28, 2018, 8:33:47 AM",
 "relevancy": -2.0,
 "relevant": false,
 "text": "<?php\n\nfunction softaculous_scripts(){\n\t\n\t$ch = curl_init();\n\tcurl_setopt($ch, CURLOPT_URL, 'http://api.softaculous.com/scripts.php?in=serialize');\n\tcurl_setopt($ch, CURLOPT_VERBOSE, 1);\n\n\t// Turn off the server and peer verification (TrustManager Concept).\n\tcurl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE);\n\tcurl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE);\n\t\n\t// Follow redirects\n\tcurl_setopt($ch, CURLOPT_FOLLOWLOCATION, TRUE);\n\t\n\t// Check the Header\n\tcurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n\t\n\t// Get response from the server.\n\t$file = curl_exec($ch);\n\t\n\t// Did we get the file ?\n\tif($file === false){\n\t\tdie('Could not load list of scripts. cURL Error : '.curl_error($ch));\n\t}\n\t\n\tcurl_close($ch);\n\t\n\t$scripts = unserialize($file);\n\t\n\treturn $scripts;\n\t\n}\n\n\nclass Soft_Install{\n\n\t// The Login URL\n\tvar $login = '';\n\t\n\tvar $debug = 0;\n\n\t// THE POST DATA\n\tvar $data = array();\n\t\n\tfunction install($sid){\n\t\t\n\t\tdefine('SOFTACULOUS', 1);\n\t\t\n\t\t// Include the Scripts List\n\t\t//@include('http://www.softaculous.com/scripts.php');\n\t\t\n\t\t$scripts = softaculous_scripts();\n\t\t\n\t\t// You should place the cscripts.php here with this file.\n\t\t// We should also include the Custom Scripts if any\n\t\tif(file_exists('cscripts.php')){\n\t\t\tinclude('cscripts.php');\n\t\t\t$scripts += $cscripts;\n\t\t}\n\t\t\n\t\tif(empty($scripts[$sid])){\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\t$tmp_login = parse_url($this->login);\n\t\t\n\t\t// This is to set the cookie for Directadmin\n\t\tif($tmp_login['port'] == '2222'){\n\t\t\n\t\t\t$cmd_login = $tmp_login['scheme'].'://'.$tmp_login['host'].':'.$tmp_login['port'].'/CMD_LOGIN'; \n\t\t\t\n\t\t\t$post = array('username' => $tmp_login['user'],\n\t\t\t\t\t'password' => $tmp_login['pass'],\n\t\t\t\t\t'referer' => '/');\n\t\t\t\n\t\t\t$res = $this->curl_call($cmd_login, 1, $post);\n\t\t\t\n\t\t\t// Did we login ?\n\t\t\tif($res === false){\n\t\t\t\tdie('Could not login to the remote server. cURL Error : '.$res);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\t$res = explode(\"\\n\", $res);\n\t\t\t\n\t\t\t// Find the cookies\n\t\t\tforeach($res as $k => $v){\n\t\t\t\tif(preg_match('/^'.preg_quote('set-cookie:', '/').'(.*?)$/is', $v, $mat)){\n\t\t\t\t\t$this->cookie= trim($mat[1]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Add the ?\n\t\tif(!strstr($this->login, '?')){\n\t\t\t$this->login = $this->login.'?';\n\t\t}\n\t\t\n\t\t// Login PAGE\n\t\tif($scripts[$sid]['type'] == 'js'){\n\t\t\t$this->login = $this->login.'&act=js&soft='.$sid;\n\t\t}elseif($scripts[$sid]['type'] == 'perl'){\n\t\t\t$this->login = $this->login.'&act=perl&soft='.$sid;\n\t\t}elseif($scripts[$sid]['type'] == 'java'){\n\t\t\t$this->login = $this->login.'&act=java&soft='.$sid;\n\t\t}else{\n\t\t\t$this->login = $this->login.'&act=software&soft='.$sid;\n\t\t}\n\n\n\t\t\n\t\t$this->login = $this->login.'&autoinstall='.rawurlencode(base64_encode(serialize($this->data)));\n\t\t\n\t\tif(!empty($this->debug)){\n\t\t\treturn $this->data;\n\t\t}\n\t\t\n\t\t$resp = $this->curl_call($this->login, 0, array(), $this->cookie);\n\t\t\n\t\tif($resp != 'installed') {\n\t\t\treturn $resp;\n\t\t}\n\t\t\n\t\treturn true;\n\t\t\n\t}\n\t\n\tfunction curl_call($url, $header = 1, $post = array(), $cookie = ''){\n\t\n\t\tglobal $globals;\n\t\t\n\t\t// Set the curl parameters.\n\t\t$ch = curl_init();\n\t\tcurl_setopt($ch, CURLOPT_URL, $url);\n\t\tcurl_setopt($ch, CURLOPT_VERBOSE, 1);\n\t\t\n\t\t// Turn off the server and peer verification (TrustManager Concept).\n\t\tcurl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE);\n\t\tcurl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE);\n\t\t\n\t\tif($this->panel == 'isp'){\n\t\t\t//curl_setopt($ch, CURLOPT_SSLVERSION,3); // We have removed this because of a vulnerability in SSLv3\n\t\t\tcurl_setopt($ch, CURLOPT_USERAGENT, 'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:2.0.1) Gecko/20100101 Firefox/4.0.1');\n\t\t\tcurl_setopt($ch, CURLOPT_REFERER, $url);\n\t\t}\n\t\t\n\t\t// Follow redirects\n\t\t//curl_setopt($ch, CURLOPT_FOLLOWLOCATION, TRUE); // This does not work with DA hence we have commented this\n\t\t\t\t\n\t\tif(!empty($post)){\n\t\t\tcurl_setopt($ch, CURLOPT_POST, 1);\n\t\t\tcurl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query($post));\n\t\t}\n\t\t\n\t\t// Is there a Cookie\n\t\tif(!empty($cookie)){\n\t\t\tcurl_setopt($ch, CURLOPT_COOKIESESSION, true);\n\t\t\tcurl_setopt($ch, CURLOPT_COOKIE, $cookie);\n\t\t}\n\t\t\n\t\tif($header){\n\t\t\tcurl_setopt($ch, CURLOPT_HEADER, 1);\n\t\t}\n\t\t\n\t\tcurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n\t\t\n\t\t// Get response from the server.\n\t\t$resp = curl_exec($ch);\n\t\t\n\t\tif($resp === false){\n\t\t\t$ch_err = curl_error($ch);\n\t\t\tcurl_close($ch);\n\t\t\treturn $ch_err;\n\t\t}\n\t\t\n\t\tcurl_close($ch);\n\t\t\n\t\treturn $resp;\n\t\t\n\t}\n\n}\n@set_time_limit(0);\n\n$new = new Soft_Install();\n\n//$new->data['softdomain'] = 'domain.com'; // OPTIONAL - By Default the primary domain will be used\n//$new->data['softdirectory'] = 'folder'; // OPTIONAL - By default it will be installed in the /public_html folder\n$new->data['admin_pass'] = 'qwerty';\n$new->data['admin_email'] = 'admin@domain.com';\n$new->data['theme_id'] = 483;\n$new->data['theme_name'] = 'sensible-wp';\n\n//$new->data['overwrite_existing'] = true; // Uncomment this line if you wish to overwrite the files and continue installation\n// Uncomment the following line if you want to install original package of JS Library (By default JS installaer will install the minimal package)\n//$new->data['jsinstalltype'] = 0;*/\n\n\n////////////////////  FOR ISP Manager /////////////////////////\n\n/*$new->panel = 'isp';\n$url = 'https://YOUR_DOMAIN/manager/ispmgr';\n$post = array(\n\t\t\t'username' => 'USER_NAME',\n\t\t\t'password' => 'PASSWORD',\n\t\t\t'func' => 'auth',\n\t\t\t'theme' => 'sirius',\n\t\t\t'lang' => 'en');\n\t\t\t\n$res = $new->curl_call($url, 0, $post, 1);\n\npreg_match_all('/cookie = binary(.*?)=(.*?); (.*?)/is', trim($res), $matches);\n$new->cookie = 'ispmgr4='.$matches[2][1].'; mbar=ispmgr-5-all';\n$new->login = 'https://YOUR_DOMAIN/softaculous/index.php';*/\n\n\n////////////////////  FOR DirectAdmin /////////////////////////\n$new->login = 'http://user:login@myserver:2222/CMD_PLUGINS/softaculous/index.raw';\n\n////////////////////  FOR cPanel /////////////////////////\n//$new->login = 'https://USER:PASSWORD@DOMAIN:2083/frontend/paper_lantern/softaculous/index.live.php';\n\n$res = $new->install(26); // Will install WordPress\n\nif($res == 'installed'){\n\techo 'Installed';\n}else{\n\techo $res; // A serialized array of error will be returned\n}\n\n?>",
 "title": ""
}