{
 "espireDate": "N",
 "format": "csharp",
 "jSonReasons": [
  "lg_en"
 ],
 "key": "UdW4SRRC",
 "pasteDate": "Feb 23, 2018, 10:11:43 AM",
 "relevancy": 1.0,
 "relevant": false,
 "text": "using System;\nusing System.Runtime.InteropServices;\nusing System.Windows.Forms;\n\nnamespace ConsoleApplication1\n{\n    public class HookDemoHelper\n    {\n        [DllImport(\"user32.dll\", SetLastError = true)]\n        private static extern IntPtr SetWindowsHookEx(int id, LowLevelKeyboardProcDelegate lpfn, IntPtr hMod, int dTh);\n\n        [DllImport(\"user32.dll\", SetLastError = true)]\n        private static extern bool UnhookWindowsHookEx(IntPtr hhk);\n\n        [DllImport(\"Kernel32.dll\", SetLastError = true)]\n        private static extern IntPtr GetModuleHandle(IntPtr lpModuleName);\n\n        [DllImport(\"user32.dll\", SetLastError = true)]\n        private static extern IntPtr CallNextHookEx(IntPtr hhk, int nCode, IntPtr wParam, IntPtr lParam);\n\n        [DllImport(\"user32.dll\")]\n        private static extern void keybd_event(int bVk, byte bScan, uint dwFlags, IntPtr dwExtraInfo);\n\n        private const int WhKeyboard = 13;\n        private const int WmKeyDown = 0x0100;\n\n        private LowLevelKeyboardProcDelegate _mCallback;\n        private IntPtr _mHHook;\n        private const uint KeyeventfKeyup = 2;\n\n        private static void SendKeyUp(int keyCode)\n        {\n            keybd_event(keyCode, 0x45, KeyeventfKeyup, (IntPtr) 0);\n        }\n\n        private IntPtr LowLevelKeyboardHookProc(int nCode, IntPtr wParam, IntPtr lParam)\n        {\n            if (nCode >= 0)\n            {\n                var keyCode = Marshal.ReadInt32(lParam);\n                if (wParam == (IntPtr) WmKeyDown)\n                {\n                    var key = ((Keys) keyCode);\n                    if (key != Keys.W && key != Keys.A && key != Keys.S && key != Keys.D)\n                    {\n                        SendKeyUp(keyCode);\n                    }\n                }\n            }\n\n            return CallNextHookEx(_mHHook, nCode, wParam, lParam);\n        }\n\n        private delegate IntPtr LowLevelKeyboardProcDelegate(int nCode, IntPtr wParam, IntPtr lParam);\n\n        public void SetHook()\n        {\n            _mCallback = LowLevelKeyboardHookProc;\n            _mHHook = SetWindowsHookEx(WhKeyboard, _mCallback, GetModuleHandle(IntPtr.Zero), 0);\n        }\n\n        public void Unhook()\n        {\n            UnhookWindowsHookEx(_mHHook);\n        }\n    }\n\n    internal static class Program\n    {\n        [STAThread]\n        private static void Main()\n        {\n            var helper = new HookDemoHelper();\n            helper.SetHook();\n            System.Windows.Forms.Application.Run();\n            helper.Unhook();\n        }\n    }\n}",
 "title": ""
}