{
 "espireDate": "N",
 "format": "text",
 "jSonReasons": [
  "kw_error",
  "lg_en"
 ],
 "key": "xeYKKPWy",
 "pasteDate": "Feb 11, 2018, 2:16:30 PM",
 "relevancy": 2.0,
 "relevant": false,
 "text": "    public void a(PacketPlayInCustomPayload packetplayincustompayload) {\n        PlayerConnectionUtils.ensureMainThread(packetplayincustompayload, this, this.player.u());\n        PacketDataSerializer packetdataserializer;\n        ItemStack itemstack;\n        ItemStack itemstack1;\n\n        try { // CraftBukkit\n        if (\"MC|BEdit\".equals(packetplayincustompayload.a())) {\n            packetdataserializer = new PacketDataSerializer(Unpooled.wrappedBuffer(packetplayincustompayload.b()));\n\n            try {\n                itemstack = packetdataserializer.i();\n                if (itemstack == null) {\n                    return;\n                }\n\n                if (!ItemBookAndQuill.b(itemstack.getTag())) {\n                    throw new IOException(\"Invalid book tag!\");\n                }\n\n                itemstack1 = this.player.inventory.getItemInHand();\n                if (itemstack1 != null) {\n                    if (itemstack.getItem() == Items.WRITABLE_BOOK && itemstack.getItem() == itemstack1.getItem()) {\n                        itemstack1 = new ItemStack(Items.WRITABLE_BOOK); // CraftBukkit\n                        itemstack1.a(\"pages\", (NBTBase) itemstack.getTag().getList(\"pages\", 8));\n                        CraftEventFactory.handleEditBookEvent(player, itemstack1); // CraftBukkit\n                    }\n\n                    return;\n                }\n            } catch (Exception exception) {\n                PlayerConnection.c.error(\"Couldn\\'t handle book info\", exception);\n                this.disconnect(\"Invalid book data!\"); // CraftBukkit\n                return;\n            } finally {\n                packetdataserializer.release();\n            }\n\n            return;\n        } else if (\"MC|BSign\".equals(packetplayincustompayload.a())) {\n            packetdataserializer = new PacketDataSerializer(Unpooled.wrappedBuffer(packetplayincustompayload.b()));\n\n            try {\n                itemstack = packetdataserializer.i();\n                if (itemstack == null) {\n                    return;\n                }\n\n                if (!ItemWrittenBook.b(itemstack.getTag())) {\n                    throw new IOException(\"Invalid book tag!\");\n                }\n\n                itemstack1 = this.player.inventory.getItemInHand();\n                if (itemstack1 != null) {\n                    if (itemstack.getItem() == Items.WRITTEN_BOOK && itemstack1.getItem() == Items.WRITABLE_BOOK) {\n                        // CraftBukkit start\n                        itemstack1 = new ItemStack(Items.WRITTEN_BOOK);\n                        itemstack1.a(\"author\", (NBTBase) (new NBTTagString(this.player.getName())));\n                        itemstack1.a(\"title\", (NBTBase) (new NBTTagString(itemstack.getTag().getString(\"title\"))));\n                        itemstack1.a(\"pages\", (NBTBase) itemstack.getTag().getList(\"pages\", 8));\n                        itemstack1.setItem(Items.WRITTEN_BOOK);\n                        CraftEventFactory.handleEditBookEvent(player, itemstack1);\n                        // CraftBukkit end\n                    }\n\n                    return;\n                }\n            } catch (Exception exception1) {\n                PlayerConnection.c.error(\"Couldn\\'t sign book\", exception1);\n                this.disconnect(\"Invalid book data!\"); // CraftBukkit\n                return;\n            } finally {\n                packetdataserializer.release();\n            }\n\n            return;\n        } else if (\"MC|TrSel\".equals(packetplayincustompayload.a())) {\n            try {\n                int i = packetplayincustompayload.b().readInt();\n                Container container = this.player.activeContainer;\n\n                if (container instanceof ContainerMerchant) {\n                    ((ContainerMerchant) container).d(i);\n                }\n            } catch (Exception exception2) {\n                PlayerConnection.c.error(\"Couldn\\'t select trade\", exception2);\n                this.disconnect(\"Invalid trade data!\"); // CraftBukkit\n            }\n        } else if (\"MC|AdvCdm\".equals(packetplayincustompayload.a())) {\n            if (!this.minecraftServer.getEnableCommandBlock()) {\n                this.player.sendMessage(new ChatMessage(\"advMode.notEnabled\", new Object[0]));\n            } else if (this.player.getBukkitEntity().isOp() && this.player.abilities.canInstantlyBuild) { // CraftBukkit - Change to Bukkit OP versus Vanilla OP\n                packetdataserializer = packetplayincustompayload.b();\n\n                try {\n                    byte b0 = packetdataserializer.readByte();\n                    CommandBlockListenerAbstract commandblocklistenerabstract = null;\n\n                    if (b0 == 0) {\n                        TileEntity tileentity = this.player.world.getTileEntity(new BlockPosition(packetdataserializer.readInt(), packetdataserializer.readInt(), packetdataserializer.readInt()));\n\n                        if (tileentity instanceof TileEntityCommand) {\n                            commandblocklistenerabstract = ((TileEntityCommand) tileentity).getCommandBlock();\n                        }\n                    } else if (b0 == 1) {\n                        Entity entity = this.player.world.a(packetdataserializer.readInt());\n\n                        if (entity instanceof EntityMinecartCommandBlock) {\n                            commandblocklistenerabstract = ((EntityMinecartCommandBlock) entity).getCommandBlock();\n                        }\n                    }\n\n                    String s = packetdataserializer.c(packetdataserializer.readableBytes());\n                    boolean flag = packetdataserializer.readBoolean();\n\n                    if (commandblocklistenerabstract != null) {\n                        commandblocklistenerabstract.setCommand(s);\n                        commandblocklistenerabstract.a(flag);\n                        if (!flag) {\n                            commandblocklistenerabstract.b((IChatBaseComponent) null);\n                        }\n\n                        commandblocklistenerabstract.h();\n                        this.player.sendMessage(new ChatMessage(\"advMode.setCommand.success\", new Object[] { s}));\n                    }\n                } catch (Exception exception3) {\n                    PlayerConnection.c.error(\"Couldn\\'t set command block\", exception3);\n                    this.disconnect(\"Invalid CommandBlock data!\"); // CraftBukkit\n                } finally {\n                    packetdataserializer.release();\n                }\n            } else {\n                this.player.sendMessage(new ChatMessage(\"advMode.notAllowed\", new Object[0]));\n            }\n        } else if (\"MC|Beacon\".equals(packetplayincustompayload.a())) {\n            if (this.player.activeContainer instanceof ContainerBeacon) {\n                try {\n                    packetdataserializer = packetplayincustompayload.b();\n                    int j = packetdataserializer.readInt();\n                    int k = packetdataserializer.readInt();\n                    ContainerBeacon containerbeacon = (ContainerBeacon) this.player.activeContainer;\n                    Slot slot = containerbeacon.getSlot(0);\n\n                    if (slot.hasItem()) {\n                        slot.a(1);\n                        IInventory iinventory = containerbeacon.e();\n\n                        iinventory.b(1, j);\n                        iinventory.b(2, k);\n                        iinventory.update();\n                    }\n                } catch (Exception exception4) {\n                    PlayerConnection.c.error(\"Couldn\\'t set beacon\", exception4);\n                    this.disconnect(\"Invalid beacon data!\"); // CraftBukkit\n                }\n            }\n        } else if (\"MC|ItemName\".equals(packetplayincustompayload.a()) && this.player.activeContainer instanceof ContainerAnvil) {\n            ContainerAnvil containeranvil = (ContainerAnvil) this.player.activeContainer;\n\n            if (packetplayincustompayload.b() != null && packetplayincustompayload.b().readableBytes() >= 1) {\n                String s1 = SharedConstants.a(packetplayincustompayload.b().c(32767));\n\n                if (s1.length() <= 30) {\n                    containeranvil.a(s1);\n                }\n            } else {\n                containeranvil.a(\"\");\n            }\n        }\n        // CraftBukkit start\n        else if (packetplayincustompayload.a().equals(\"REGISTER\")) {\n            String channels = packetplayincustompayload.b().toString(com.google.common.base.Charsets.UTF_8);\n            for (String channel : channels.split(\"\\0\")) {\n                getPlayer().addChannel(channel);\n            }\n        } else if (packetplayincustompayload.a().equals(\"UNREGISTER\")) {\n            String channels = packetplayincustompayload.b().toString(com.google.common.base.Charsets.UTF_8);\n            for (String channel : channels.split(\"\\0\")) {\n                getPlayer().removeChannel(channel);\n            }\n        } else {\n            byte[] data = new byte[packetplayincustompayload.b().readableBytes()];\n            packetplayincustompayload.b().readBytes(data);\n            server.getMessenger().dispatchIncomingMessage(player.getBukkitEntity(), packetplayincustompayload.a(), data);\n        }\n        // CraftBukkit end\n        // CraftBukkit start\n        } finally {\n            if (packetplayincustompayload.b().refCnt() > 0) {\n                packetplayincustompayload.b().release();\n            }\n        }\n        // CraftBukkit end\n    }",
 "title": ""
}